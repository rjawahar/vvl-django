<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css"><!-- custom css for loan officer process -->

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script><!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script><!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script><!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 

</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
	{% include "header_common.html" %} 
	</div>
	
	<!-- Main Content -->
    	<div class="main">	
	    <div class="task-div">	
		<div class="main-task">
		    <div  class="right-pane-task" id="right-pane-task" style="width:100%;margin: 10 auto;">
			<div class="center-pane" style="width:50%;margin: 3% auto; display:block;">
				<!--Header of a Div--> 
				<div class="h3-heading" >
					<h3 >Prepare Loan Cheque</h3>
					<h4 id="load_id">Loan No : ( 514243656648453 )  &  Member Id : ( 551 )</h4>
				</div>
				<!--Input Values-->
				<div class="member_class" >
				    <div class="colomn-div"><label>Loan A/C Number</label> <font>  : </font> <input type="text" id="fk_loan_account_number" name="" placeholder="LOAN A/C NUMBER" disabled/><font class="mandatory">*</font></div>
				</div>
				<div class="member_class" >
				    <div class="colomn-div"><label>Cheque Number</label>   <font>  : </font>   <input type="text" id="chq_number"           name="" placeholder="CHEQUE NUMBER"	/><font class="mandatory">*</font></div>
				</div>
				<div class="member_class">
				    <div  class="colomn-div"><label>Cheque Issuer(Bank name)</label><font>  : </font>
				    <select id="chq_issue_bank_name" class="extra select form-control bank_name chq_issue_bank_name"  name="chq_issue_bank_name"  placeholder="chq_issue_bank_name (DROPDOWN)">
					</select>
				    <font class="mandatory">*</font></div>
				</div>
				<div class="member_class">
				    <div  class="colomn-div"><label>Sanction Amount</label><font>  : </font> <input type="text" id="loan_sanctioned_amount" name="" placeholder="SACTION AMOUNT"/><font class="mandatory">*</font></div>
				</div>
				<div class="member_class">
				    <div  class="colomn-div"><label>Date Of Cheque</label> <font>  : </font> <input type="date" id="chq_issued_on_date"     name="" placeholder="DATE OF CHEQUE"/><font class="mandatory">*</font></div>
				</div>
				<!--Submit Button Div-->
				<div class="form-group text-center">
				    <div class="">
					<div class="colomn-div-footer" >
					<a href="javascript:void(0)" 	onclick='prepareLoanCheque("Approved","1");' class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
					   <i class="icon-entypo-check" style="width:30px;height: 28px;color: white;padding:6px;"></i>
					    Submit
					</a>
					</div>
				    </div>
				</div>	
			</div> 
		    </div>
	 	</div>
	    </div>
  	</div>
	{% include "footer.html" %} 
</body>
<script type="text/javascript">  
	
var taskData = {};
var memberdetails= '{{ memberDetails	| safe}}';
var processid 	 = '{{ processId	| safe}}';
var process 	 = '{{ process		| safe}}';
var taskid 	 = '{{ taskId		| safe}}';
var memberId 	 = '{{ memberId		| safe}}';
var loanId 	 = '{{ loanId		| safe}}';
var userid 	 = '{{ userId		| safe}}';
var User 	 = '{{ user		| safe}}';
var remarks      = '{{ Application_Remarks | safe}}';
var processObj   =  JSON.parse(process);

jQuery(document).ready(function($) {

    /*Date picker*/
    $("#chq_issued_on_date").datepicker({ dateFormat: 'yy-mm-dd', changeMonth: true,//this option for allowing user to select month
    	  changeYear: true });
    	  
    /*Drop down for Top bar on USER login and logout*/ 	
    $('.dropDownHook span').on('click', function() {
        $(this).parents('.dropDownHook').children('.dropDownContent').stop(true, true).slideToggle('medium', function() {
            if ($('.dropDownContent').is(':visible')) {
            }
            else {
            }
        });
    });
    $('html').on('click', function() {
        $('.dropDownContent:visible').slideToggle('fast');
    });
    $('.dropDownHook > *').on('click', function(event) {
        event.stopPropagation();
    });

    /*Master data Parsing and Painting in HTML*/	
    setSelectOptionInForm();	/*Function in masterDataLoad.js	*/
    
    /*Data Parsing and Painting data in HTML*/
    if(memberdetails){
	memberdetails =  JSON.parse(memberdetails);
	console.log(memberdetails);
	if(memberdetails['dcphysicalArray']){
	    if(memberdetails['dcphysicalArray'][0]){
		var dispatchData = memberdetails['dcphysicalArray'][0];
		var keys = Object.keys(dispatchData);
		for(var i=0; i<keys.length; i++){
		    if(document.getElementById(keys[i])){
			document.getElementById(keys[i]).innerHTML = dispatchData[keys[i]];
		    }
		}
	    }
	}
	if(memberdetails['mlcompositeArray'][0]['account_number']){
		var account_number = memberdetails['mlcompositeArray'][0]['account_number'];
		document.getElementById('fk_loan_account_number').value = account_number;
	}
    }

    /*Header For DIV*/	
    if(loanId){
	$(".h3-heading h4").html("Loan Id : "+loanId+ "    &     Member Id : "+memberId+"");
    }
});

function prepareLoanCheque(d, val){

	/*Current Date*/
	var currentDateValue  = (new Date());
	currentDateValue = JSON.stringify(currentDateValue);
	currentDateValue = currentDateValue.replace(/"/g,'');

	/*Input Values*/
	var fk_loan_account_number = document.getElementById('fk_loan_account_number').value;
	var chq_number		   = document.getElementById('chq_number').value;
	var chq_issue_bank_name    = document.getElementById('chq_issue_bank_name').value;
	var loan_sanctioned_amount = document.getElementById('loan_sanctioned_amount').value;
	var chq_issued_on_date     = document.getElementById('chq_issued_on_date').value;
	
	
	/*Validation for input Values*/
	if(!chq_number){
		alert('Please enter Cheque Number');
		return false;
	}
	if(!chq_issue_bank_name){
		alert('Please enter Bank Name');
		return false;
	}
	if(!loan_sanctioned_amount){
		alert('Please enter Sactioned Amount');
		return false;
	}
	if(!chq_issued_on_date){
		alert('Please enter Cheque issued on Date');
		return false;
	}
	
	/*Format input values for AVRO*/
	var chequedetailArray = {"chequedetailArray":[
				{


"preche_member_id"	: parseInt(memberId),
"preche_loan_id"	: parseInt(loanId),
"loan_account_number"	, loan_account_number,
"preche_cheque_number"	, preche_cheque_number,
"preche_bank_name"	, preche_bank_name,
"preche_bank_branch"	, preche_bank_branch,
"payee_name"		, payee_name,
"loan_sanctioned_amount", loan_sanctioned_amount,
"loan_sanctioned_date"	, loan_sanctioned_date,
"chq_issued_on_date"	, chq_issued_on_date,
"last_modified_date"	: currentDateValue,
"last_modified_by"	: userid 
				
"preche_member_id"	: parseInt(memberId),
"preche_loan_id"	: parseInt(loanId),
"loan_account_number"	, "type": "string"},
"preche_cheque_number"	, "type": "string"},
"preche_bank_name"	, "type": "string"},
"preche_bank_branch"	, "type": "string"},
"payee_name"		, "type": "string"},
"loan_sanctioned_amount"	, "type": "double"},
"loan_sanctioned_date"	, "type": "string"},
"chq_issued_on_date"	, "type": "string"},
"last_modified_date"	: currentDateValue,
"last_modified_by"	: userid 		
		
				   "fk_member_id"	  
				   "fk_loan_id"		   : parseInt(loanId),
				   "fk_loan_account_number": fk_loan_account_number,
				   "chq_number"	 	   : parseInt(chq_number),
				   "chq_issue_bank_name"   : chq_issue_bank_name,
				   "loan_sanctioned_amount": parseFloat(loan_sanctioned_amount),
				   "chq_issued_on_date"	   : chq_issued_on_date,
				   "last_modified_date"	   : currentDateValue,
				   "last_modified_by"	   : userid 
			        }
		             ]
                         };

	var processupdate = {"variables": { "Book_Loan_&_Cheque_Status" : { "value" : "Prepared" } } };

	/*Merge Data for Sending Through POST query*/
	var dataObj = {};
	dataObj['processid'] 	= processid;
	dataObj['process'] 	= processupdate;	
	dataObj['taskid'] 	= taskid;
	dataObj['loanId'] 	= loanId;
	dataObj['memberId'] 	= memberId;
	dataObj['chequedetailArray'] = chequedetailArray;

	/*AJAX call:* /
	var url = "/prepareLoanCheckAdd/";
	$.ajax({
	    url: url,
	    type: 'post',
	    dataType: 'json',
	    success: function (data) {
		window.location='/tasks/';		
	    },
	    data: JSON.stringify(dataObj)
	});*/
	
	var processupdate = {"variables": { "Book_Loan_&_Cheque_Status" : { "value" : "Prepared" } } };
	var data = {
	        "process" : processupdate,
	        "taskid"  : taskid      
	        }            
	            
    	urls = '/updateTask';

        $.ajax({
	        url: urls,
	        type: 'post',
	        dataType: 'json',
	        success: function(data){
		        if(data.message == "Successful"){
			        console.log(data);
			        window.location='/tasks/';
		        }else{
			        alert("Failed due to some Issue . Please try after sometime or contact your Administrator");
		        }
	        },
	        data: JSON.stringify(data)
        });

}

</script>
</html>
