<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css">	<!-- custom css for loan officer process -->
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
			

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 


<style>
@media only screen and (min-width:601px){
	font{

		padding-left:15px;
	}
	.colomn-div label{
		font-size:13px;
		display	: inline-block;
		width: 35%;
		/*width	: 30%;
		/*text-align:right;*/
		color:#981b1b;
		text-align: left;
		padding-left: 15%;
	}
	.colomn-div{
	   	width: 88%;
	    	height: 40px;
	}
	.img-input input{
		width	: 43%;
		margin-left:43.5%;
	}
	.center-pane{
		width:55%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
	}
	.h3-heading h3{
		padding-top:20px;
		color:white;
		font-weight:bolder;
		margin-top:initial;
	}
	.right-pane-task{
		width:100%;
		margin: 10 auto;
	}

}
@media only screen and (min-width:0px) and (max-width:600px){
	font{

		padding-left:15px;
	}
	.right-pane-task{
		width:95%;

	}
	.center-pane{
		width:90%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
		line-height:normal;
	}
	.img-input input{
			
		margin-left:44.5%;
	}
	.file_img{
	    margin-right: 15%;
	}
.modal {
	       display: none; 
	       position: fixed; 
	       z-index: 1; 
	       padding-top:100px; 
	       left: 0;
	       top: 0;
	       width: 100%; 
	       height: 100%;
	       overflow: auto; 
	       background-color: rgb(0,0,0); 
	       background-color: rgba(0,0,0,0.4); 
	}
	
	.modal-body {
		 position: relative;
		 /*padding: 20px;*/
		 border:1px solid #981b1b;
          	 /*height:100%;*/
		 overflow-y: auto;
    		 max-height: 400px;
		 word-wrap:break-word;
	
		}
	.modal_comment_div{
		 border: 1px solid #aaaaaa;/*#981b1b;*/
		padding:1%;
		border-radius:10px;
		margin-bottom:4px;
		color:#981b1b;
		
	}
	.comment{
		margin-bottom: 2%;
		margin-left: 14px;
    		color:black;
    		width:90%;		
		line-height:2;
		
	}

	.modal-content {
			background-color: #fefefe;
			margin: auto;
			/*padding: 20px;*/
			border: 5px solid #981b1b;
			width: 60%;
			height:64%;   
		}

	.close {
			color: #aaaaaa;
			float: right;
			font-size: 25px;
			font-weight: bold;
	}

	.close:hover,
	.close:focus {
		color: #000;
		text-decoration: none;
		cursor: pointer;
	}
	
}
</style>

</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
		{% include "header_common.html" %} 
	</div>

	{% csrf_token %}
	<!-- Main Content -->
    	<div class="main">	
	    <div class="task-div">	
		<div class="main-task">
		   <div  class="right-pane-task" id="right-pane-task" style="width:100%;margin: 10 auto;">
			<div id="myModal" class="modal">
				<!-- Modal content -->
				  <div class="modal-content">
				    <span class="close">x</span>
				    <p><strong>COMMENTS</strong></p>
					<div class="modal-body">
						<div class="modal_comment_div">
							<p><font class="entypo-user"  id="comment_username_1">User1</font>
							   <font id="comment_date_1" style="float:right;padding-right:20px;">Date:18-06-2016</font></br>
								<div class="comment">
									<font id="user_comment_1">Comments</font>
								</div>
							</p>
						</div>
						<div class="modal_comment_div">
							<p><font class="entypo-user"  id="comment_username_2">User2</font>
							   <font id="comment_date_2" style="float:right;padding-right:20px;">Date:20-06-2016</font></br>
								<div class="comment">
									<font id="user_comment_2">Comments</font>
								</div>
							</p>
						</div>
						<div class="modal_comment_div">
							<p><font class="entypo-user"  id="comment_username_3">User1</font>
							   <font id="comment_date_3" style="float:right;padding-right:20px;">Date:02-07-2016</font></br>
								<div class="comment">
									<font id="user_comment_3">Comments</font>
								</div>
							</p>
						</div>
						<div class="modal_comment_div">
							<p><font class="entypo-user"  id="comment_username_4">User3</font>
							   <font id="comment_date_4" style="float:right;padding-right:20px;">Date:13-07-2016</font></br>
								<div class="comment">
									<font id="user_comment_4">Comments</font>
								</div>
							</p>
						</div>
						<div class="modal_comment_div">
							<p><font class="entypo-user"  id="comment_username_5">User2</font>
							   <font id="comment_date_5" style="float:right;padding-right:20px;">Date:18-07-2016</font></br>
								<div class="comment">
									<font id="user_comment_5">Comments</font>
								</div>
							</p>
						</div>
					</div>
				</div>
			</div>
			
			<div class="right-pane-task-detail detail-max" id="right-pane-task-detail" style="background-color: rgba(218, 216, 216, 0.2);">
			    	<span class="comment-toggle" style="float:right;display:inline-block;padding-bottom:10px;s"><i class="entypo-chat"></i> Comments</span>
     		        	<div class="center-pane" id="center-pane" > 
		       			<!--Div HEader-->
					<div class="h3-heading" >
						<h3 >	Uploaded Documents	</h3>
						<h4 	id="loan_id">		Loan ID : 	<span id="doc_loan_id">	</span> ,  	 Member Id : 	<span id="doc_member_id">	</span> 	& User ID: 	<span id="doc_fk_last_modified_by">	</span>	 </h4>
					</div>
					<!--INput Values-->
					
				</div>
				<div class="popup">	</div>
				<!--Submit Button DIv-->
				<div class="form-group text-center">
				       	<textarea style="width:45%;height:20%;background-color:white;font-size: 11px;" id="comments"    placeholder="Comments"></textarea><font class="mandatory">*</font>
 				    	<div class="form-button">
						<a 	href="javascript:void(0)" 	onclick='' 	class="btn btn-red btn-icon icon-left" 		style="height:30px;padding-left:40px;">
					  	<i 	class="icon-entypo-cancel"	 style="width:30px;height: 28px;color: white;padding:6px;">	</i>
					   	Close
						</a>
						<a 	href="javascript:void(0)" 	onclick='submitForm("Rework");' 	class="btn btn-red btn-icon icon-left" 		style="height:30px;padding-left:40px;">
					  	<i 	class="icon-entypo-cancel"	 style="width:30px;height: 28px;color: white;padding:6px;">	</i>
					   	Rework
						</a>
						<a 	href="javascript:void(0)" 	onclick='submitForm("Approved");' 	class="btn btn-red btn-icon icon-left" 		style="height:30px;padding-left:40px;">
					  	<i 	class="icon-entypo-cancel"	 style="width:30px;height: 28px;color: white;padding:6px;">	</i>
					   	Approve
						</a>
					</div>								
				</div>
				
		  	</div>
			<div class="right-pane-task-comment-list comment-min" id="right-pane-task-comment-list">	
			    		<h3>Comments</h3>
						<div class="comment-list-pane" id="comment-list-pane"> </div>																		
		   	</div>
			
		    </div>
	        </div>
	    </div>
        </div>
	<div class="popup">
	</div>
	{% include "footer.html" %} 
</body>
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script>
<!--script type="text/javascript">  

$(document).ready(function() {
	
	if($(window).width() >= 601){
			$('.comment-toggle').on('click', function () {
		   	 	 $('#right-pane-task-detail').toggleClass('detail-max detail-min');
				 $('#right-pane-task-comment-list').toggleClass('comment-min comment-max');
			});
	}
	if($(window).width() <= 600){
			$('.comment-toggle').on('click', function () {
				$('#myModal').css('display','block');
			});
			$('.close').on('click', function (){
				  $('#myModal').css('display','none');
			});
			window.onclick = function(event) {
				if (event.target == document.getElementById('myModal')) {
				 	$('#myModal').css('display','none');
				}
			}	    	
		}
	var screenHeight  = $(window).height();
	var screenwidth   = $(window).width();
	if(screenHeight){
		var height       =  screenHeight*(0.9);
		var slipHeight   =  height/3;
		$('body').height((height*(0.80)));
		$('.task-div').height((height*(0.80)));
		$('.main-task').height((height*(0.80)));
		$('#right-pane-task').height((height));
		$('#right-pane-task-detail').height((height*(0.75)));
		$('#right-pane-task-comment-list').height((height*(0.795)));
		document.getElementById('right-pane-task-detail').style.overflowY  =  'auto';

	}
});

	$(function() {
		$("#tabs").tabs();
	});
	
	var data1  =  "{{ data | escapejs }}";
	json_data  =  JSON.parse(data1);

	if(json_data.documentsArray)
	{
		for(var i=0 ; i<json_data.documentsArray.length; i++)
		{	
			var objTo =  document.getElementById('center-pane')
			var member_class  =  document.createElement("div");
			var obj  =  json_data.documentsArray[i];
			member_class.innerHTML  =  '<div class="member_class"><div class="colomn-div"><label id="doc_status_'+(i+1)+'"></label><font>:</font>'+
										 '<font id="doc_name_'+(i+1)+'" name="doc_name_'+(i+1)+'"  ></font>'+
			 								'<img id="doc_url_'+(i+1)+'_img_pop" class="file_img" src=""></img></div></div>';	
			objTo.appendChild(member_class);
			for(var key in obj)
			{
				if(key == "doc_name"  && document.getElementById(key+"_"+(i+1)+"") )
					document.getElementById(key+"_"+(i+1)+"").innerHTML=obj["doc_name"];
				if(key == "doc_url"  && document.getElementById(key+"_"+(i+1)+'_img_pop'))
					$('#'+key+"_"+(i+1)+'_img_pop').attr("src",	obj[key]);
				if(key == "doc_status"  && document.getElementById(key+"_"+(i+1)+""))
					document.getElementById(key+"_"+(i+1)+"").innerHTML=obj["doc_status"];
				if(document.getElementById(key))
					document.getElementById(key).innerHTML 	=	obj[key];
			}
		}
	}

	imagePopUp();
		

</script-->
<script type="text/javascript"> 

    var data1     = "{{ memberDetails 	| escapejs }}";
    var member_id = "{{ memberId	| escapejs }}";
    var loan_id	  = "{{ loanId 		| escapejs }}";	
    var user_id	  = "{{ user 		| escapejs }}";
    var task_id   = "{{ taskId 		| escapejs }}";
    var processid = "{{processId	| safe	   }}";
    var alf_token   = "{{ alf_token	| escapejs }}";    
    
    json_data  =  JSON.parse(data1);
    
    	/*For Comments*/
	var html='<label class="comment-user" >No Comments</label>';
	if(json_data.mlcompositeArray){
		var objData = json_data.mlcompositeArray[0];
		if(objData['mlValidationArray'].length>0){
	    	    html=''; 		
		    for(var i=0;i<objData['mlValidationArray'].length; i++){
		    	var usernme = objData['mlValidationArray'][i]['validation_fk_last_modified_by'];
		    	var remarks = objData['mlValidationArray'][i]['remarks'];	
		    	var validation_last_modified_date = objData['mlValidationArray'][i]['validation_last_modified_date'];	

			html +='<div id="comment-pane" class="comment-pane">'
				    +'<div class="comments-list-pane">'
					+'<label class="comment-user" ><i class="entypo-user"></i>'+usernme+'</label> <font class="comment-date"> '+validation_last_modified_date+' </font>'
					+'<div class="comment-comment">'+remarks+'</div>'
				    +'</div>'
				+'</div>';	    
		    }	
		}
	}
	document.getElementById('comment-list-pane').innerHTML = html;
    
    
 /*For Tab Pane*/
$(document).ready(function() {

    $('.comment-toggle').on('click', function () {
	$('#right-pane-task-detail').toggleClass('detail-max detail-min');
	$('#right-pane-task-comment-list').toggleClass('comment-min comment-max');
    });

    $(".tabs-menu a").click(function(event) {
        event.preventDefault();
        $(this).parent().addClass("current");
        $(this).parent().siblings().removeClass("current");
        var tab = $(this).attr("href");
        $(".tab-content").not(tab).css("display", "none");
        $(tab).fadeIn();
    });
});

    var imageArr = ["jpeg", "jpg", "exif", "tiff", "gif", "bmp", "png", "image/jpeg"]	;
     	
    if(json_data.documentsArray){
	if(json_data.documentsArray[0]){
	    for(var i=0 ; i<json_data.documentsArray.length; i++)
		{	
			var objTo 	  =  document.getElementById('center-pane')
			var member_class  =  document.createElement("div");
			var obj  	  =  json_data.documentsArray[i];
			member_class.innerHTML  =  '<div class="member_class"><div class="colomn-div"><label id="doc_status_'+(i+1)+'"></label><font>:</font>'+
							 '<font id="doc_name_'+(i+1)+'" 	name="doc_name_'+(i+1)+'"     ></font>'+
			 				 '<img  id="doc_url_'+(i+1)+'_img_pop"  class="file_img" 	src=""></img>'+
			 				 '<a    id="doc_url_'+(i+1)+'_anchor" 	class="file_img" > <i class="fa fa-file-text" aria-hidden="true"></i></a>'+
			 				 '</div></div>';	
			objTo.appendChild(member_class);
			
			if(obj["doc_name"]  && document.getElementById("doc_name_"+(i+1)+"") ){
				document.getElementById("doc_name_"+(i+1)+"").innerHTML=obj["doc_name"];
			}
			
			if(obj["doc_url"]  && document.getElementById("doc_url_"+(i+1)+"_img_pop") ){					
				
			    if(( $.inArray(obj['doc_type'], imageArr)) != -1){
			    	console.log("11212    " + obj['doc_type']);
			    	console.log('"'+obj['doc_type']+'"');
			    	console.log(document.getElementById('#doc_url_'+(i+1)+'_img_pop'));			    	
			    
				//if(document.getElementById('#doc_url_'+(i+1)+'_img_pop')){
							    	console.log("11    " + obj['doc_type']);
    			            $('#doc_url_'+(i+1)+'_img_pop').attr("src",	obj['doc_url']+'?alf_ticket='+alf_token);
    			            $('#doc_url_'+(i+1)+'_anchor' ).css("display","none");   
    			        //}
    			        
			    }else if(obj['doc_url'] != 'Document not attached' ){
			    
			    	if(obj['doc_type'] == "pdf"){	
			    	     $('#doc_url_'+(i+1)+'_anchor').html('<i class="fa fa-file-pdf-o" aria-hidden="true"></i>');
		    	        }
			    	if(obj['doc_type'] == "xlsx"){	
			    	     $('#doc_url_'+(i+1)+'_anchor').html('<i class="fa fa-file-excel-o" aria-hidden="true"></i>');
		    	        }
			    	if(obj['doc_type'] == "docx" || obj['doc_type'] == "doc" ){	
			    	     $('#doc_url_'+(i+1)+'_anchor').html('<i class="fa fa-file-text" aria-hidden="true"></i>');
		    	        }	            	        
		    	        	            	        
		                $('#doc_url_'+(i+1)+'_anchor').attr("href",	obj['doc_url']+'?alf_ticket='+alf_token);
		                $('#doc_url_'+(i+1)+'_anchor').css("color",	'#981b1b');
			        $('.fa').css("font-size",	'25px');
			        $('.fa').css("margin-left",	'-14px');
			        //$('#doc_url_'+(i+1)+'_anchor').css("background",	'white');    			            		            
		                $('#doc_url_'+(i+1)+'_img_pop').css("display","none");
		                $('#doc_url_'+(i+1)+'_img_pop').css("max-height","100%");
		                $('#doc_url_'+(i+1)+'_img_pop').css("max-width","100%");	                   
		                
			    }else{
    			            $('#doc_url_'+(i+1)+'_img_pop').css("display","none"); 
    			            $('#doc_url_'+(i+1)+'_anchor').css("display","none");    			            		            
			    
			    }  	
			}	
			if(obj["doc_status"]  && document.getElementById("doc_status_"+(i+1)+"")){
				document.getElementById("doc_status_"+(i+1)+"").innerHTML=obj["doc_status"];
			}
			if(document.getElementById('doc_url')){
				document.getElementById('doc_url').innerHTML 	=	obj['doc_url'];
			}
			var obj= json_data.documentsArray[i];
	       	 	console.log(obj);
		}
	    
	        
                imagePopUp();
	    }		
    }
    imagePopUp();
    

    function submitForm(d){
        
	        var processupdate = {"variables": { 
			        "Upload_Doc_Status" : { "value" : d	}
		            	}  
		            };
		data = {
		        "process" : processupdate,
		        "taskid"  : task_id      
		}           
		
		
		var remarks = '';
		if(document.getElementById('comments')){
			 remarks = document.getElementById('comments').value;
		}
		if(remarks.length < 1){
			alert('Please Comment');
			return false;
		}
			
		var d 		= new Date(); // for now
		var currentTime	= (d.getHours()+":"+d.getMinutes()).toString();
	
		var currentDateValue  = (new Date());
		currentDateValue = JSON.stringify(currentDateValue);
		currentDateValue = currentDateValue.replace(/"/g,'');
		currentDateValue = currentDateValue.split('T')[0];

		var remarksData =    { 
					"validation_member_id" 		: parseInt(member_id),
					"validation_loan_id" 		: parseInt(loan_id),
					"validation_type" 		: parseInt(1),
					"validation_level"		: parseInt(1),
					"validation_status" 		: parseInt(3),
					"remarks" 			: remarks, 
					"process_id" 			: processid,
					"task_id" 			: task_id,
					"validation_fk_last_modified_by": user_id,
					"validation_last_modified_date"	: ""+currentDateValue +" at "+ currentTime+"",
					"validation_fk_sci_client_id"	: parseInt(1)
				     };

		var dataObj = {};
		dataObj['processid'] 	= processid;
		dataObj['taskremarks']  = remarksData;
		dataObj['loanid'] 	= loan_id;
		dataObj['taskid'] 	= task_id;
		dataObj['userid'] 	= user_id;
		dataObj['process'] 	= processupdate;
		dataObj['remarksData'] 	= remarksData;	 
		            
		/*Loading IMages*/	
		var theImg = '<div class="loading"><img style="width:350px;height:250px;" src="/static/images/buffer-loading.gif">'
			 +'<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>'
				    +'</div>'
			+'</div>';
		$(".popup").empty().append(theImg).fadeIn();	

            	urls = '/updateTask';

	        $.ajax({
		        url: urls,
		        type: 'post',
		        dataType: 'json',
		        success: function(data){
		        	$(".popup").fadeOut();
			        if(data.message == "Successful"){
				        console.log(data);
				        window.location='/tasks/';
			        }else{
				        alert("Failed due to some Issue . Please try after sometime or contact your Administrator");
			        }
		        },
		        data: JSON.stringify(dataObj)
	        });
        }
        
        

</script>
</html>
