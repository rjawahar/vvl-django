<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css">				<!-- custom css for loan officer process -->

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 


<style>
	.colomn-div input {
	   display: inline-block;
	   width: 45%;
	   margin-left: 5%;
	}
	.colomn-div select {
	    display: inline-block;
	    width: 45%;
	    margin-left: 5%;
	}
	.h3-heading h3{
		padding-top:20px;
		color:white;
		font-weight:bolder;
		margin-top:initial;
	}
	.ml_fk_alf_node_ref_img{
		margin-left:25px;
		width:50%;
	}
	.colomn-div label{
		font-size:13px;
		display	: inline-block;
		width: 35%;
		text-align: left;
		padding-left: 15%;
	}
	.img-input input{
			width	: 43%;
			margin-left:43.5%;
	}
	.center-pane{
		width:50%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
	}
@media only screen and (min-width:0px) and (max-width:600px){
	.modal {
	       display: none; 
	       position: fixed; 
	       z-index: 1; 
	       padding-top:100px; 
	       left: 0;
	       top: 0;
	       width: 100%; 
	       height: 100%;
	       overflow: auto; 
	       background-color: rgb(0,0,0); 
	       background-color: rgba(0,0,0,0.4); 
	}
	.modal-body {
		 position: relative;
		 border:1px solid #981b1b;
		 overflow-y: auto;
   		 max-height: 400px;
		 word-wrap:break-word;
	}
	.modal_comment_div{
		border: 1px solid #aaaaaa;
		padding:1%;
		border-radius:10px;
		margin-bottom:4px;
		color:#981b1b;
	}
	.comment{
		margin-bottom: 2%;
		margin-left: 14px;
   		color:black;
   		width:90%;		
		line-height:2;
	}
	.modal-content {
		background-color: #fefefe;
		margin: auto;
		border: 5px solid #981b1b;
		width: 60%;
		height:64%;   
	}
	.close {
			color: #aaaaaa;
			float: right;
			font-size: 25px;
			font-weight: bold;
	}
	.close:hover,
	.close:focus {
		color: #000;
		text-decoration: none;
		cursor: pointer;
	}
	
}
</style>

<script type="text/javascript">  

	var taskData = {};
	var memberdetails = '{{ memberDetails    | safe		}}';
	var processid 	  = '{{ processId        | safe		}}';
	var process 	  = '{{ process          | safe		}}';
	var loan_id	  = "{{ loanId 		 | escapejs 	}}";	
	var user_id	  = "{{ user 		 | escapejs 	}}";
	var task_id	  = "{{ taskId 		 | escapejs 	}}";
	var processid 	  = "{{ processId	 | safe	   	}}";
	var User 	  = '{{ user             | safe		}}';
	var userid	  = '{{ userId           | safe		}}';
	var memberId 	  = '{{ memberId         | safe		}}';
	var loanId 	  = '{{ loanId           | safe		}}';
	var remarks 	  = '{{ Application_Remarks | safe	}}';
	var json_data     = '';

	jQuery(document).ready(function($) {
		var screenHeight  = $(window).height();
		var screenwidth   = $(window).width();
		if(screenHeight)
		{
			var height       =  screenHeight*(0.9);
			var slipHeight   =  height/3;
			$('body').height((height*(0.80)));
			$('.task-div').height((height*(0.80)));
			$('.main-task').height((height*(0.80)));
			$('#right-pane-task').height((height));
			$('#right-pane-task-detail').height((height*(0.85)));
			$('#right-pane-task-comment-list').height((height*(0.895)));
			document.getElementById('right-pane-task-detail').style.overflowY  =  'auto';
		}

		if($(window).width() >= 601){
			$('.comment-toggle').on('click', function () {
				$('#right-pane-task-detail').toggleClass('detail-max detail-min');
				$('#right-pane-task-comment-list').toggleClass('comment-min comment-max');
			});
		}
		if($(window).width() <= 600){
			$('.comment-toggle').on('click', function () {
				$('#myModal').css('display','block');
			});
			$('.close').on('click', function (){
				  $('#myModal').css('display','none');
			});
			window.onclick = function(event) {
				if (event.target == document.getElementById('myModal')) {
				 $('#myModal').css('display','none');
				}
			}	    	
		}
		$(function() {
			$("#tabs").tabs();
		});

    	$('.dropDownHook span').on('click', function() {
		    $(this).parents('.dropDownHook').children('.dropDownContent').stop(true, true).slideToggle('medium', function() {
		        if ($('.dropDownContent').is(':visible')) {
		        }
		        else {
		        }
		    });
    	});
		$('html').on('click', function() {
		    $('.dropDownContent:visible').slideToggle('fast');
		});
		$('.dropDownHook > *').on('click', function(event) {
		    event.stopPropagation();
		});
		/*Div header with loan and member id*/
		if(loanId){  	document.getElementById("loan_id").innerHTML = "Loan Id :  " +loan_id+ "    &   Member Id : "+memberId;    }
		
		/*Parse Data*/
		if(memberdetails){	json_data = JSON.parse(memberdetails);    }
    
		/*Master Data Parse and paint on screen*/
		setSelectOptionInForm();	/*Function in masterDataLoad.js	*/
		
		if(json_data.dcphysicalArray){
		    if(json_data.dcphysicalArray.length > 0){
		         $('#despatch_button').css("display","none");    
		         $('#redespatch_button').css("display","block");
		    }
		    for(var i=0;i<json_data.dcphysicalArray.length;i++){	
		        var obj=json_data.dcphysicalArray[i];
		        for(key in obj){	
		            if(document.getElementById(key)){
		                 document.getElementById(key).value  =   obj[key];
		            }
		        }	
		    }		
   		 }
    
        var allData = (JSON.parse(memberdetails));
    	/*For Comments*/
		var html='<label class="comment-user" >No Comments</label>';
		if(allData.mlcompositeArray){
			var objData = allData.mlcompositeArray[0];
			if(objData['mlValidationArray'].length>0){
				html=''; 		
				for(var i=0;i<objData['mlValidationArray'].length; i++){
					var usernme = objData['mlValidationArray'][i]['validation_fk_last_modified_by'];
					var remarks = objData['mlValidationArray'][i]['remarks'];	
					var validation_last_modified_date = objData['mlValidationArray'][i]['validation_last_modified_date'];	

					html +='<div id="comment-pane" class="comment-pane">'
							+'<div class="comments-list-pane">'
							+'<label class="comment-user" ><i class="entypo-user"></i>'+usernme+'</label> <font class="comment-date"> '+validation_last_modified_date+' </font>'
							+'<div class="comment-comment">'+remarks+'</div>'
							+'</div>'
							+'</div>';	    
		    	}	
			}
		}	
		document.getElementById('comment-list-pane').innerHTML = html;
    
	});

	function onSubmit(dataSubmit, val){
		/*Input Values*/
		var doc_courier_name			= document.getElementById("doc_courier_name").value;
		var doc_courier_tracking_id		= document.getElementById("doc_courier_tracking_id").value;
		var doc_courier_receipt_number		= document.getElementById("doc_courier_receipt_number").value;
		var doc_courier_handover_date		= document.getElementById("doc_courier_handover_date").value;
		var place				= document.getElementById("place").value;

		/*Input value validation*/
		if(!doc_courier_name){
			alert('Please enter Courier Name');
			return false;
		}
		if(!doc_courier_receipt_number){
			alert('Please enter Courier receipt Number');
			return false;
		}
		if(!doc_courier_handover_date){
			alert('Please enter Date');
			return false;
		}
		if(!doc_courier_tracking_id){
			alert('Please enter Tracking Id');
			return false;
		}
	
		var d 		= new Date(); // for now
		var currentTime	= (d.getHours()+":"+d.getMinutes()).toString();
	
		var currentDateValue  = (new Date());
		currentDateValue = JSON.stringify(currentDateValue);
		currentDateValue = currentDateValue.replace(/"/g,'');
		currentDateValue = currentDateValue.split('T')[0];

		/*Process Details formating*/
		var processCompleteTask = { "variables": { "Despatch_Doc_Status" : { "value" : dataSubmit } } };
		var dataObj 		= {};
	
		dataObj['memberid'] 	= memberId;
		
		var remarks = '';
		if(json_data.dcphysicalArray){
		    if(json_data.dcphysicalArray.length > 0){	
			/*Comments*/
			if(document.getElementById('comments')){
				 remarks = document.getElementById('comments').value;
			}  
			/*Alert if no Comments*/	
			if(remarks.length < 1){
				alert('Please Comment.');
				return false;
			}
		    }	
		}
		

		var remarksData =    { 
					"validation_member_id" 		: parseInt(memberId),
					"validation_loan_id" 		: parseInt(loan_id),
					"validation_type" 		: parseInt(1),
					"validation_level"		: parseInt(1),
					"validation_status" 		: parseInt(val),
					"remarks" 			: remarks, 
					"process_id" 			: processid,
					"task_id" 			: task_id,
					"validation_fk_last_modified_by": user_id,
					"validation_last_modified_date"	: ""+currentDateValue +" at "+ currentTime+"",
					"validation_fk_sci_client_id"	: parseInt(1)
					 };

		dataObj['processid'] 	= processid;
		dataObj['taskremarks']  = remarksData;
		dataObj['loanid'] 	= loan_id;
		dataObj['taskid'] 	= task_id;
		dataObj['userid'] 	= userid;
		dataObj['process'] 	= processCompleteTask;
		dataObj['remarksData'] 	= remarksData;	
	
		/*Current Data*/	
		var currentDateValue  = (new Date());
		currentDateValue = JSON.stringify(currentDateValue);
		currentDateValue = currentDateValue.replace(/"/g,'');

		/*Formating the input values for AVRO*/
		var dataArr = {"dcphysicalArray":[
				{
				"fk_member_id"			: parseInt(memberId)		,
				"fk_loan_id"			: parseInt(loanId)		,
				"doc_courier_tracking_id" 	: doc_courier_tracking_id	,
				"doc_courier_handover_date" 	: doc_courier_handover_date	,
				"doc_courier_name"	  	: doc_courier_name		,
				"doc_courier_receipt_number"	: doc_courier_receipt_number	,	
				"doc_courier_tracking_id "	: doc_courier_tracking_id 	,
				"last_modified_by"		: userid			,
				"place"				: place	
				}]
			        };
	
		/*Merging of data for sending through POST AJAX*/
		var dataObj = {
			"dispatchDetails": dataArr,
			"processDetails" : processCompleteTask,
			"taskid"	 : task_id
		}

		var theImg = '<div class="loading"><img style="width:350px;height:250px;" src="/static/images/buffer-loading.gif">'
				+'<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>'
				+'</div>'
				+'</div>';
		$(".popup").empty().append(theImg).fadeIn();
		/*AJAX call:*/
		$.ajax({
			url: '/savedespatchdoc',
			type: 'POST',
			dataType: 'json',
			success: function (data) {
				$(".popup").fadeOut();
				window.location='/tasks/';
			},
			error: function(error) {
				console.log(error);
			},
			data: JSON.stringify(dataObj)			
		});

	}
</script>
</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
		{% include "header_common.html" %} 
	</div>

	<form action="." id="despatch-form">
	<!--{% csrf_token %}-->
	<!-- Main Content -->
    	<div class="main">	
	    	<div class="task-div">	
				<div class="main-task">
				    <div  class="right-pane-task" id="right-pane-task" style="width:100%;">	
						<div id="tabs">
							<ul id="form-tab">
								<li style="float:right;list-style-type:none;">
									<span class="comment-toggle" style="float:right;display:inline-block;padding-bottom:10px;"><i class="entypo-chat"></i> Comments</span>
								</li>
							</ul>
						</div>
						<div id="myModal" class="modal">
							<!-- Modal content -->
							  <div class="modal-content">
								<span class="close">x</span>
								<p><strong>COMMENTS</strong></p>
								<div class="modal-body">
									<div class="modal_comment_div">
										<p><font class="entypo-user"  id="comment_username_1">User1</font>
										   <font id="comment_date_1" style="float:right;padding-right:20px;">Date:18-06-2016</font></br>
											<div class="comment">
												<font id="user_comment_1">Comments</font>
											</div>
										</p>
									</div>
									<div class="modal_comment_div">
										<p><font class="entypo-user"  id="comment_username_2">User2</font>
										   <font id="comment_date_2" style="float:right;padding-right:20px;">Date:20-06-2016</font></br>
											<div class="comment">
												<font id="user_comment_2">Comments</font>
											</div>
										</p>
									</div>
									<div class="modal_comment_div">
										<p><font class="entypo-user"  id="comment_username_3">User1</font>
										   <font id="comment_date_3" style="float:right;padding-right:20px;">Date:02-07-2016</font></br>
											<div class="comment">
												<font id="user_comment_3">Comments</font>
											</div>
										</p>
									</div>
									<div class="modal_comment_div">
										<p><font class="entypo-user"  id="comment_username_4">User3</font>
										   <font id="comment_date_4" style="float:right;padding-right:20px;">Date:13-07-2016</font></br>
											<div class="comment">
												<font id="user_comment_4">Comments</font>
											</div>
										</p>
									</div>
									<div class="modal_comment_div">
										<p><font class="entypo-user"  id="comment_username_5">User2</font>
										   <font id="comment_date_5" style="float:right;padding-right:20px;">Date:18-07-2016</font></br>
											<div class="comment">
												<font id="user_comment_5">Comments</font>
											</div>
										</p>
									</div>
								</div>
							</div>
						</div>
						<div class="right-pane-task-detail detail-max" id="right-pane-task-detail" style="background-color: rgba(218, 216, 216, 0.2);">	    <div class="center-pane" > 
						   	<!--Div HEader-->
							<div class="h3-heading" >
								<h3 >Dispatch Documents</h3>
								<h4 id="loan_id">Loan No : <span id="loan_Id">514243656648453</span>    &   Member Id : <span id="member_Id">551</span> </h4>
							</div>
							<!--INput Values-->
							<div class="member_class" >
								<div class="colomn-div">
									<label>Courier Name</label>
									<font>  : </font>
								    <select id="doc_courier_name" class="extra select form-control chq_courier_name"   	name="chq_courier_name"  	placeholder="chq_courier_name"	></select> 
									<font class="mandatory">*</font>
								</div>
							</div>
							<div class="member_class" >
								<div class="colomn-div">
									<label>Courier Number/Tracking Id</label>
									<font>  : </font>
									<input  type="text" id="doc_courier_tracking_id"   	name="doc_courier_tracking_id"		placeholder="COURIER NUMBER/ TRACKING ID"/>
									<br><br>
								</div>
							</div>
							<div class="member_class" >
								<div class="colomn-div">
									<label>Receipt Number</label>
									<font>  : </font>						
									<input  type="text" id="doc_courier_receipt_number"   	name="doc_courier_receipt_number"	placeholder="RECEIPT NUMBER"/>
									</br>
								</div>
							</div>
							<div class="member_class" >
								<div class="colomn-div">
									<label>Date</label>
									<font>  : </font>						
									<input  type="date" id="doc_courier_handover_date"   	name="doc_courier_handover_date"	placeholder="DATE"/>
									</br>
								</div>
							</div>
							<div class="member_class" >
								<div class="colomn-div">
									<label>Place</label>
									<font>  : </font>						
									<input  type="text" id="place"   		name="place"	 			placeholder="PLACE"/>
									</br>
								</div>
							</div>				
						</div>
						<!--Submit Button DIv-->
						<div class="form-group text-center">
							<div class="form-button" id="despatch_button">
								<a href="javascript:void(0)" onclick='' class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
								   <i class="icon-entypo-cancel" style="width:30px;height: 28px;color: white;padding:6px;"></i>
									Cancel
								</a>
								<a onclick="onSubmit('New','1');" class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
									<i class="icon-entypo-check" style="width:30px;height: 28px;color: white;padding:6px;"></i>
									Submit
								</a>
							</div>
                            <div class="form-button" id="redespatch_button"  style="display:none;">
                                <textarea style="width:45%;height:20%;background-color:white;font-size: 11px;" id="comments"    placeholder="Comments"></textarea><font class="mandatory">*</font>
                                <div style="padding-top:1%;">
									<a href="javascript:void(0)" onclick='' class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
										   <i class="icon-entypo-cancel" style="width:30px;height: 28px;color: white;padding:6px;"></i>
											Cancel
									</a>
									<a onclick="onSubmit('ReworkCompleted','3');" class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
											<i class="icon-entypo-check" style="width:30px;height: 28px;color: white;padding:6px;"></i>
											Rework Completed
									</a>
								</div>
				    		</div>    				    
						</div>
		  	   		</div>
			  	    <div class="right-pane-task-comment-list comment-min " id="right-pane-task-comment-list" style="width:21%;overflow-y:scroll;">	
						<div class="head" style="background-color: #981B1B;color: whitesmoke;border-bottom: 1px solid whitesmoke;" data-toggle="collapse" data-target="#comment-list-pane">
							<div class="sub-header" >
							  <div colspan="4"> Comments <i class="entypo-chat"></i></div>
							</div>
						</div>
						<div  class="comment-list-pane" id="comment-list-pane"></div>
					</div>
				</div><div class="popup">	</div>
	    	</div>
		</div>
	 </div>
</form>
{% include "footer.html" %} 
</body>
</html>

