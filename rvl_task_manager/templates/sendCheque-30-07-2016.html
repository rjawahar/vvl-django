<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css">				<!-- custom css for loan officer process -->

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 


<style>

@media only screen and (min-width:601px){
	.colomn-div label{
		font-size:13px;
		display	: inline-block;
		width: 39%;
		/*width	: 30%;
		/*text-align:right;*/
		text-align: left;
		padding-left: 10%;
	
	}
	.colomn-div input {
	        display: inline-block;
	        width: 45%;
	        margin-left: 5%;

	}
	.img-input input{
		width	: 43%;
		margin-left:43.5%;
	}

	.center-pane{
		width:50%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
	}
	.h3-heading h3{
		padding-top:20px;
		color:white;
		font-weight:bolder;
		margin-top:initial;
	}
	.right-pane-task{
		width:100%;
		margin: 10 auto;
	}
}
@media only screen and (min-width:0px) and (max-width:600px){

	.right-pane-task{
		width:95%;

	}
	#right-pane-task-detail {
	        border: 2px solid #981b1b;
	        padding: 2%;
	        background: rgba(218, 216, 216, 0.3);
	}
	.center-pane{
		width:90%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
	}
	.colomn-div label{
		font-size:12px;
		padding-left:10%;
	}
	
}	
</style>

</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
		{% include "header_common.html" %} 
	</div>

	{% csrf_token %}
	<!-- Main Content -->
    	<div class="main">	
	   	 <div class="task-div">	
			<div class="main-task">
		  		<div  class="right-pane-task" id="right-pane-task">
					<div class="right-pane-task-detail detail-max"  	id="right-pane-task-detail" 	style="background-color: rgba(218, 216, 216, 0.2);">
     		        			<div class="center-pane" > 
		       					<!--Div HEader-->
							<div class="h3-heading" >
								<h3 >		Send Cheque	</h3>
								<h4 	id="loan_id">		Loan ID : 	<span id="che_loan_id">	198	</span> &   	Member ID :	 <span id="che_member_id">	421	</span>  	</h4>
							</div>
							<!--INput Values-->
							<div class="member_class" style="padding-top:8px;">
							   	<div class="colomn-div">	<label>		Loan Account Number		 	</label>	<font>  : </font> 
									<input   type="text" readonly="true" 	id="loan_account_number" 		name="loan_account_number" 			placeholder="LOAN ACCOUNT NUMBER"/>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Cheque Number 				</label>	<font>  : </font> 
									<input   type="text" 	readonly="true"	id="cheque_number" 			name="cheque_number" 				placeholder="CHEQUE NUMBER"/>
								</div>
							</div>
							<div class="member_class">
							   	<div class="colomn-div">	<label>		Courier Name				</label>	<font>  : </font> 
									<!--input   type="text" 		id="che_courier_name" 			name="che_courier_name" 			placeholder="COURIER NAME"/-->
									<select id="che_courier_name" class="extra select form-control chq_courier_name che_courier_name"    	name="chq_courier_name"  	placeholder="chq_courier_name"	style="width: 45%;margin-left: 5%;">
							        	</select> 
				        	
	    	                                                </div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Courier Number / Tracking ID		</label>	<font>  : </font> 
									<input   type="text"		id="che_courier_tracking_id" 		name="che_courier_tracking_id"			placeholder="COURIER NUMBER/TRACKING ID"/>
								</div>
							</div>
							<div class="member_class">
							   	 <div class="colomn-div">	<label>		Receipt Number				</label>	<font>  : </font> 
									<input   type="text" 		id="che_courier_receipt_number" 	name="che_courier_receipt_number" 		placeholder="RECEIPT NUMBER"/>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Cheque Handover Date			</label>	<font>  : </font> 
									<input   type="date" 		id="che_courier_handover_date" 		name="che_courier_handover_date" 		placeholder="DATE"></input>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Place					</label>	<font>  : </font> 
									<input   type="text" 		id="place" 				name="place" 					placeholder="PLACE"/>
								</div>
							</div>
						</div>
					 	<!--Submit Button DIv-->
						<div class="form-group text-center">
						   	<div class="form-button">
								<a 	href="javascript:void(0)" 	onclick=''	      class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
							   		<i 	class="icon-entypo-cancel" 	style="width:30px;height: 28px;color: white;padding:6px;">	</i>
							    		Cancel
								</a>
								<a 	href="javascript:void(0)"	onclick="onSubmit();" class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
							    		<i class="icon-entypo-check" 		style="width:30px;height: 28px;color: white;padding:6px;"></i>
							    		Save
								</a>
						    	</div>
						</div>
					</div>
	   			 </div>
			</div>
		</div>
	</div>

	{% include "footer.html" %} 


<script type="text/javascript">  

    var taskData     = {};
    var memberdetails= '{{ memberDetails	| safe}}';
    var processid 	 = '{{ processId	| safe}}';
    var process 	 = '{{ process		| safe}}';
    var taskid 	     = '{{ taskId		| safe}}';
    var memberId     = '{{ memberId		| safe}}';
    var loanId 	     = '{{ loanId		| safe}}';
    var userid 	     = '{{ userId		| safe}}';
    var User 	     = '{{ user		| safe}}';
    var remarks      = '{{ Application_Remarks | safe}}';
    var processObj   =  JSON.parse(process);

    	
    /*Data Parsing and Painting data in HTML*/
    if(memberdetails){
	memberdetails =  JSON.parse(memberdetails);
	console.log(memberdetails);
	if(memberdetails['dcphysicalArray']){
	    if(memberdetails['dcphysicalArray'][0]){
		var dispatchData = memberdetails['dcphysicalArray'][0];
		var keys = Object.keys(dispatchData);
		for(var i=0; i<keys.length; i++){
		    if(document.getElementById(keys[i])){
			document.getElementById(keys[i]).innerHTML = dispatchData[keys[i]];
		    }
		}
	    }
	}
	if(memberdetails['mlcompositeArray']){
	    if(memberdetails['mlcompositeArray'][0]['account_number']){	
		var account_number = memberdetails['mlcompositeArray'][0]['account_number'];
		document.getElementById('loan_account_number').value = account_number;
	    }
	}
	if(memberdetails['PrepareCheque']){
		var preche_cheque_number = memberdetails['PrepareCheque']['preche_cheque_number'];
		document.getElementById('cheque_number').value = preche_cheque_number;
	}
    }


    setSelectOptionInForm();	/*Function in masterDataLoad.js	*/	

    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth()+1; //January is 0!
    var yyyy = today.getFullYear();

    if(dd<10) {
        dd  =  '0'+dd;
    } 

    if(mm<10) {
        mm  =  '0'+mm;
    } 
    today   = yyyy + '- '+ dd + '-' + mm;
    
   
    function onSubmit()
    {
    	var che_member_id 			= document.getElementById("che_member_id").innerHTML;
	var che_loan_id				= document.getElementById("che_loan_id").innerHTML;
	var loan_account_number			= document.getElementById("loan_account_number").value;
	var cheque_number			= document.getElementById("cheque_number").value;
	var che_courier_name			= document.getElementById("che_courier_name").value;
	var che_courier_tracking_id		= document.getElementById("che_courier_tracking_id").value;
	var che_courier_receipt_number		= document.getElementById("che_courier_receipt_number").value;
	var che_courier_handover_date		= document.getElementById("che_courier_handover_date").value;
	var place				= document.getElementById("place").value;
	var last_modified_by			= "{{user}}";
		
	/*Formating the input values for AVRO*/
	var dataArr = {"memberChequeArray":
				[{
				"che_member_id"			: parseInt(che_member_id),
				"che_loan_id"			: parseInt(che_loan_id),
				"loan_account_number"		: loan_account_number,
				"cheque_number"			: cheque_number,
				"che_courier_name"		: che_courier_name,
				"che_courier_tracking_id"	: che_courier_tracking_id,
				"che_courier_receipt_number"	: che_courier_receipt_number,
				"che_courier_handover_date"	: che_courier_handover_date,
				"place"				: place,
				"last_modified_by"		: last_modified_by,
				"last_modified_date"		: today

				}]
		            };
	var cheque_info = new FormData();
	cheque_info.append('form_data' , JSON.stringify(dataArr) );
	cheque_info.append('taskId' , '{{taskId}}' );	
	
	/*Loading IMages*/	
	var theImg = '<div class="loading"><img style="width:350px;height:250px;" src="/static/images/buffer-loading.gif">'
		 +'<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>'
			    +'</div>'
		+'</div>';
	$(".popup").empty().append(theImg).fadeIn();
	
	var opts = {
		    url: '/sendCheque',
		    data: cheque_info,
		    cache: false,
		    contentType: false,
		    processData: false,
		    dataType: 'json',
		    type: 'POST',
		    success: function (data) 
		    {	
			$(".popup").fadeOut();
			//window.location='/tasks/';
		    },
		    error: function(error) 
		    {
		    	$(".popup").fadeOut();
			console.log(error)
		    }
		
		};
	if(cheque_info.fake) {
	    // Make sure no text encoding stuff is done by xhr
	    opts.xhr = function() { var xhr = jQuery.ajaxSettings.xhr(); xhr.send = xhr.sendAsBinary; return xhr; }
	    opts.contentType = "multipart/form-data; boundary="+cheque_info.boundary;
	    opts.data = cheque_info;
	}
	
	jQuery.ajax(opts);
   	
	
}
</script>
</body>
</html>
