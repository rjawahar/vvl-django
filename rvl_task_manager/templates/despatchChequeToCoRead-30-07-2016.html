<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css">				<!-- custom css for loan officer process -->

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap    js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 


<style>
	.colomn-div input {
   display: inline-block;
   width: 45%;
   margin-left: 5%;

}
.h3-heading h3{
		padding-top:20px;
		color:white;
		font-weight:bolder;
		margin-top:initial;
		
	}

	.ml_fk_alf_node_ref_img{

		margin-left:25px;
		width:50%;
	}
	.colomn-div label{
			font-size:13px;
			display	: inline-block;
			width: 35%;
			/*width	: 30%;
			/*text-align:right;*/
			text-align: left;
			padding-left: 15%;
		
	}
	.img-input input{
			width	: 43%;
			margin-left:43.5%;
	}

	.center-pane{
		width:50%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
	}
</style>
<style>
#ui-datepicker-div{
	z-index: 999;
}
</style>
<script type="text/javascript">  
	
var taskData = {};
var memberdetails = '{{ memberDetails    | safe}}';
var processid 	  = '{{ processId        | safe}}';
var process 	  = '{{ process          | safe}}';
var task_id 	  = '{{ taskId           | safe}}';
var User 	  = '{{ user             | safe}}';
var user_id	  = '{{ userId           | safe}}';
var memberId 	  = '{{ memberId         | safe}}';
var loan_id 	  = '{{ loanId           | safe}}';
var remarks 	  = '{{ Application_Remarks | safe}}';
var json_data     = '';

jQuery(document).ready(function($) {

    /*Date Picker*/	
    $("#doc_courier_handover_date").datepicker({ dateFormat: 'yy-mm-dd', changeMonth: true,//this option for allowing user to select month
     	changeYear: true });

    /*Dropdown menu for users */	
    $('.dropDownHook span').on('click', function() {
        $(this).parents('.dropDownHook').children('.dropDownContent').stop(true, true).slideToggle('medium', function() {
            if ($('.dropDownContent').is(':visible')) {
            }
            else {
            }
        });
    });
    $('html').on('click', function() {
        $('.dropDownContent:visible').slideToggle('fast');
    });
    $('.dropDownHook > *').on('click', function(event) {
        event.stopPropagation();
    });



    /*Div header with loan and member id*/
    if(loan_id){
	document.getElementById("loan_id").innerHTML = "Loan Id :  " +loan_id+ "    &   Member Id : "+memberId;
    }
    
    /*Parse Data*/
    if(memberdetails){	json_data = JSON.parse(memberdetails);    }
    
    /*Master Data Parse and paint on screen*/
    setSelectOptionInForm();	/*Function in masterDataLoad.js	*/
    
	if(json_data.dcphysicalArray){
	    for(var i=0;i<json_data.dcphysicalArray.length;i++){	
	        var obj=json_data.dcphysicalArray[i];
		for(key in obj){	
		    if(document.getElementById(key)){
		         document.getElementById(key).innerHTML  =   obj[key];
	            }
		}	
	    }		
	}
});

function onSubmit(d){
        
        var processupdate = {"variables": { "Despatch_Doc_Status" : { "value" : d } } };
        
	var data = {
	        "process" : processupdate,
	        "taskid"  : task_id      
	        }            
	            
	            
		
		
	var remarks = '';
	if(document.getElementById('comments')){
		 remarks = document.getElementById('comments').value;
	}
	/*Alert if no Comments*/	
	if(remarks.length < 1){
		alert('Please Comment');
		return false;
	}	

	var d 		= new Date(); // for now
	var currentTime	= (d.getHours()+":"+d.getMinutes()).toString();

	var currentDateValue  = (new Date());
	currentDateValue = JSON.stringify(currentDateValue);
	currentDateValue = currentDateValue.replace(/"/g,'');
	currentDateValue = currentDateValue.split('T')[0];

	var remarksData =    { 
				"validation_member_id" 		: parseInt(memberId),
				"validation_loan_id" 		: parseInt(loan_id),
				"validation_type" 		: parseInt(1),
				"validation_level"		: parseInt(1),
				"validation_status" 		: parseInt(3),
				"remarks" 			: remarks, 
				"process_id" 			: processid,
				"task_id" 			: task_id,
				"validation_fk_last_modified_by": user_id,
				"validation_last_modified_date"	: ""+currentDateValue +" at "+ currentTime+"",
				"validation_fk_sci_client_id"	: parseInt(1)
			     };

	var dataObj = {};
	dataObj['processid'] 	= processid;
	dataObj['taskremarks']  = remarksData;
	dataObj['loanid'] 	= loan_id;
	dataObj['taskid'] 	= task_id;
	dataObj['userid'] 	= user_id;
	dataObj['process'] 	= processupdate;
	dataObj['remarksData'] 	= remarksData;	 
		            

	            
    	urls = '/updateTask';

	/*Loading IMages*/	
	var theImg = '<div class="loading"><img style="width:350px;height:250px;" src="/static/images/buffer-loading.gif">'
		 +'<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>'
			    +'</div>'
		+'</div>';
	$(".popup").empty().append(theImg).fadeIn();

        $.ajax({
	        url: urls,
	        type: 'post',
	        dataType: 'json',
	        success: function(data){
	        	$(".popup").fadeOut();
		        if(data.message == "Successful"){
			        console.log(data);
			        window.location='/tasks/';
		        }else{
			        alert("Failed due to some Issue . Please try after sometime or contact your Administrator");
		        }
	        },
	        data: JSON.stringify(dataObj)
        });
        
}

</script>
</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
		{% include "header_common.html" %} 
	</div>

	<form action="." id="despatch-form">
	<!--{% csrf_token %}-->
	<!-- Main Content -->
    	<div class="main">	
	    <div class="task-div">	
		<div class="main-task">
		   <div  class="right-pane-task" id="right-pane-task" style="width:100%;margin: 10 auto;">
			<div class="right-pane-task-detail detail-max" id="right-pane-task-detail" style="background-color: rgba(218, 216, 216, 0.2);">
     		        
		   	    <div class="center-pane" > 
		       		
		     		<!--Div HEader-->
				<div class="h3-heading" >
					<h3 >Despatch Documents</h3>
					<h4 id="loan_id">Loan No : <span id="loan_Id">514243656648453</span>    &   Member Id : <span id="member_Id">551</span> </h4>
				</div>
				
				<!--INput Values-->
				<div class="member_class" >
				    <div class="colomn-div">
					<label>Courier Name</label>
					<font>  : </font>
					<font id="doc_courier_name"></font>
			        	</br>
				     </div>
				</div>
				<div class="member_class" >
				    <div class="colomn-div">
					<label>Courier Number/Tracking Id</label>
					<font>  : </font>
					<font id="doc_courier_tracking_id"></font>					
			        	</br>
					</div>
				</div>
				<div class="member_class" >
				    <div class="colomn-div">
					<label>Receipt Number</label>
					<font>  : </font>
					<font id="doc_courier_receipt_number"></font>											
			        	</br>
				    </div>
				</div>
				<div class="member_class" >
				    <div class="colomn-div">
					<label>Date</label>
					<font>  : </font>				
					<font id="doc_courier_handover_date"></font>							
			        	</br>
				    </div>
				</div>
				<div class="member_class" >
				    <div class="colomn-div">
					<label>Place</label>
					<font>  : </font>
					<font id="place"></font>											
			        	</br>
				    </div>
				</div>				
				</div>
				<!--Submit Button DIv-->
				
		         
				<div class="form-group text-center">
   				    <textarea style="width:45%;height:20%;background-color:white;font-size: 11px;" id="comments"    placeholder="Comments"></textarea><font class="mandatory">*</font>
				    <div class="form-button">
					<a href="javascript:void(0)" onclick='' class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
					   <i class="icon-entypo-cancel" style="width:30px;height: 28px;color: white;padding:6px;"></i>
					    Cancel
					</a>
					<a onclick="onSubmit('Rework');" class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
					    <i class="icon-entypo-check" style="width:30px;height: 28px;color: white;padding:6px;"></i>
					    Rework
					</a>
					<a onclick="onSubmit('Approved');" class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
					    <i class="icon-entypo-check" style="width:30px;height: 28px;color: white;padding:6px;"></i>
					    Approve
					</a>
				    </div>
				</div>
		  	    </div>
			</div>
	    	    </div>
		</div>
	    </div>
	</form>

	{% include "footer.html" %} 
</body>
</html>

