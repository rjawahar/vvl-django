<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="/static/css/default.css" />
<link rel="stylesheet" type="text/css" href="/static/css/component.css" />
<script src="/static/js/modernizr.custom.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery-confirm.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/css/task.css" rel="stylesheet" />
<link type="text/css" href="/static/css/datepicker3.css" rel="stylesheet">
<link type="text/css" href="/static/css/styles.css" rel="stylesheet">

<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/dashBoard.css">
<link rel="stylesheet" type="text/css" href="/static/css/datatables.min.css"/> 
<!--link rel="stylesheet" type="text/css" href="/static/css/jquery.dataTables.min.css"/> 


<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/datatables.min.js"></script>
<!--script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script-->
<script type="text/javascript" src="/static/js/dataTables.fixedHeader.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.12/api/fnPagingInfo.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>	<!-- Bootstrap min js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 
<script type="text/javascript" src="/static/js/lumino.glyphs.js"></script>
<script type="text/javascript" src="/static/js/jquery-confirm.js"></script>
<script type="text/javascript" src="/static/js/bootstrap-datepicker.js"></script>
<style>
.calendarInput{
width:20%;

}
.loading label{
	font-size:15px;
}

</style>
<body>
	<!-- New Top Bar --->
	<div class="page-container horizontal-menu sidebar-collapsed">
	<header class="navbar navbar-fixed-top">
		<!-- set fixed position by adding class "navbar-fixed-top" -->
		<div class="navbar-inner">
			<!-- logo -->
			<div class="navbar-brand">
				<a href="/"> <img src="/static/images/mbe_logo.png" alt="" style="width:88px;height:20px;"> </a>
			</div>
			<!-- main menu -->
			<ul class="navbar-nav">
				<li class="dashboard root-level active">
					<a href="/tasks/"><img src="/static/images/Task-White.png" alt="" style="max-width:18px;max-height:18px;">&nbsp;<span>Tasks</span></a>
				</li>
				<li class="pg root-level ">
					<a href="/vvlForms/"><i class="entypo-users"></i><span>VVL Form</span></a>
				</li>
				<!-- Search Bar -->
			</ul>

			<!-- notifications and other links -->
			<ul class="nav navbar-right pull-right">
				<!-- dropdowns -->
				<li class="dropdown globe">
					<a href="#" class="dropdown-toggle " data-toggle="dropdown" data-hover="dropdown" data-close-others="true"> <i class="entypo-globe"></i>  </a>
					<!-- dropdown menu (messages) -->
					<ul class="dropdown-menu">
						<li class="top">
							<p class="small">
								You have <strong>0</strong> new notifications.
							</p>
						</li>
						<li>
							<ul class="dropdown-menu-list scroller" tabindex="5003" style="overflow: hidden; outline: none;">
							</ul>
						</li>
						<li class="external">
							<a href="/notifications/">View all notifications</a>
						</li>
						<div id="ascrail2003" class="nicescroll-rails" style="padding-right: 3px; width: 10px; z-index: 1000; position: absolute; top: 0px; left: -10px; height: 0px; cursor: default; display: none;">
							<div style="position: relative; top: 0px; float: right; width: 5px; height: 0px; background-color: rgb(212, 212, 212); border: 1px solid rgb(204, 204, 204); background-clip: padding-box; border-top-left-radius: 1px; border-top-right-radius: 1px; border-bottom-right-radius: 1px; border-bottom-left-radius: 1px;"></div>
						</div>
						<div id="ascrail2003-hr" class="nicescroll-rails" style="height: 7px; z-index: 1000; top: -7px; left: 0px; position: absolute; cursor: default; display: none;">
							<div style="position: relative; top: 0px; height: 5px; width: 0px; background-color: rgb(212, 212, 212); border: 1px solid rgb(204, 204, 204); background-clip: padding-box; border-top-left-radius: 1px; border-top-right-radius: 1px; border-bottom-right-radius: 1px; border-bottom-left-radius: 1px;"></div>
						</div>
						<div id="ascrail2000" class="nicescroll-rails" style="padding-right: 3px; width: 10px; z-index: 1000; position: absolute; top: 0px; left: -10px; height: 0px; cursor: default; display: none;"><div style="position: relative; top: 0px; float: right; width: 5px; height: 0px; border: 1px solid rgb(204, 204, 204); border-radius: 1px; background-color: rgb(212, 212, 212); background-clip: padding-box;"></div></div><div id="ascrail2000-hr" class="nicescroll-rails" style="height: 7px; z-index: 1000; top: -7px; left: 0px; position: absolute; cursor: default; display: none;">
							<div style="position: relative; top: 0px; height: 5px; width: 0px; border: 1px solid rgb(204, 204, 204); border-radius: 1px; background-color: rgb(212, 212, 212); background-clip: padding-box;"></div>
						</div>
					</ul>
				</li>

				<!-- raw links -->
				<li class="dropdown">
					<a href="#"> <i class="entypo-user"></i>  {{user}}  </a>
				</li>
				<li class="dropdown">
					<!-- add class "pull-right" if you want to place this from right -->
					<a href="#" class="dropdown-toggle" data-toggle="dropdown"> <i class="entypo-cog"></i> </a>
					<ul class="dropdown-menu">
						<li>
							<p>
								<span class="line"> <strong> {{user}} </strong> </span><br>
								<span class="line desc small"> None </span>
							</p>
						</li>
						<li>
							<a href="/settings/"> Settings </a>
						</li>
						<li>
							<a href="/logout/"> Log Out </a>
						</li>
					</ul>
				</li>

				<!-- mobile only -->
				<li class="visible-xs">

					<!-- open/close menu icon (do not remove if you want to enable menu on mobile devices) -->
					<div class="horizontal-mobile-menu visible-xs">
						<a href="#" class="with-animation"><!-- add class "with-animation" to support animation --> <i class="entypo-menu"></i> </a>
					</div>
				</li>
			</ul>
		</div>
	</header>
	</div>

	
	<!-- Main Content -->
    	<div class="main">	
	    <div class="task-div" style="width:90%;">	
		<div class="main-task">
			<!-- Main Content -->
		    <!--div  class="right-pane-task" id="right-pane-task" style="width:90%;">	<br-->
		     
		
		<!--div class="row">
			<a href="/FilterLoansByDate/"><div class="col-xs-12 col-md-6 col-lg-3" >
				<div class="panel panel-orange panel-widget">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<svg class="glyph stroked pencil"><use xlink:href="#stroked-pencil"/></svg>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right" style="background-color:#ffb53e;">
							<div class="text-muted">New Loan</div>
						</div>
					</div>
				</div>
			</div></a>
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-teal panel-widget">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<svg class="glyph stroked checkmark"><use xlink:href="#stroked-checkmark"/></svg>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right" style="background-color:#1ebfae;">
							<div class="text-muted">Approved</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-red panel-widget">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"/></svg>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right" style="background-color:#f9243f;">
							<div class="text-muted">Rejected</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-blue panel-widget ">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<svg class="glyph stroked hourglass" ><use xlink:href="#stroked-hourglass"/></svg>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right" style="background-color:#30a5ff;">
							<div class="text-muted">In Progress</div>
						</div>
					</div>
				</div>
			</div>
			
		</div><!--/.row-->
		<div class="right-pane-task" id="right-pane-task" style="width:83.5%;height:90%;">
		<div class="row">
		<div class="mainDiv">
			<div class="col-lg-12" style="width:20%;">
				<div id="rejectedHeader" style="display:none"><h2  style="margin-left:8px;color:#981b1b;">Rejected List</h2></div>
				<div id="approvedHeader" style="display:none"><h2  style="margin-left:8px;color:#981b1b;">Approved List</h2></div></div>
				<div class="filterMainDiv" style="width:60%;margin-left:0px;">
		
			<div class="filterInputMainDiv" style="width:15%;"><h4>Filter By</h4>
				<select class="loanFilterDropdown" id="loanFilterDropdown"></select>
			</div>
			<div class="filterInputContentDiv">
				<div id="filterByDate" class="filterBy" style="display:none;">
					<label style="margin-left:5%;">Select Date : </label>&nbsp<input type="text" class="calendarInput calendar" id="filterByDateInput"></input>&nbsp&nbsp
					<button type="submit" onclick="submitFormData(1);" class="btn btn-default btn-md pull-right" style="width:13%;font-size:13px;font-weight:bold;">Submit</button>
				</div>
				<div id="filterByMonth" class="filterBy" style="display:none;">	
					<label style="margin-left:5%;">Select Month From : </label>&nbsp&nbsp<input type="text" class="calendarInput calendar" id="filterByMonthFrom"></input>&nbsp&nbsp
					<label style="margin-left:5%;">To : </label>&nbsp&nbsp<input type="text" class="calendarInput calendar" id="filterByMonthTo"></input>&nbsp&nbsp
					<button type="submit" onclick="submitFormData(3);" class="btn btn-default btn-md pull-right" style="width:13%;font-size:13px;font-weight:bold;">Submit</button>
				</div>
				<div id="filterByWeek"  class="filterBy" style="display:none;">	
					<label style="margin-left:5%;">Select Week From : </label>&nbsp&nbsp<input type="text" class="calendarInput calendar" id="filterByWeekFrom"></input>&nbsp&nbsp
					<label style="margin-left:5%;">To : </label>&nbsp&nbsp<input type="text" class="calendarInput calendar" id="filterByWeekTo"></input>&nbsp&nbsp
					<button type="submit" onclick="submitFormData(2);" class="btn btn-default btn-md pull-right" style="width:13%;font-size:13px;font-weight:bold;">Submit</button>
				</div>
			</div>
			<br><br>
		</div>
		<div id="totalCountDiv" style="display:none;width:16%;font-size:15px;">
				<h3 style="color:#981b1b;">Total Count : <span id="recordCount"></span> / <span id="totalCount"></span> </h3>
			</div>
			</div>
		</div><!--/.row--><div id="popup1" style="display:none;"><img style="width:50%;margin:15% 0% 0% 20%;" align="middle" src="/static/images/images.jpg"></div>
		<div id="tableContent"><table id="FilteredDataTable" class="cell-border"></table></div>
		</div>		
		<div class="popup"></div>
		
	</div>	
</div></div>
  	
  	
	{% include "footer.html" %} 
</body>
<script type="text/javascript" src="/static/task/task.js"></script> 
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 
<script>

		var status = '{{ status | safe }}';
		console.log(status);
	
		$('.calendar').datepicker({
		});
		
		
		!function ($) {
		    $(document).on("click","ul.nav li.parent > a > span.icon", function(){          
		        $(this).find('em:first').toggleClass("glyphicon-minus");      
		    }); 
		    $(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
		}(window.jQuery);

		$(window).on('resize', function () {
		  if ($(window).width() > 768) $('#sidebar-collapse').collapse('show')
		})
		$(window).on('resize', function () {
		  if ($(window).width() <= 767) $('#sidebar-collapse').collapse('hide')
		})
		
		$(document).ready(function(){
			setSelectOptionInForm();
			
		});
		$(document).on("change",".loanFilterDropdown",function(){
			if(this.value == 1){
				$('#filterByDate').css("display","block");
				$('#filterByMonth').css("display","none");
				$('#filterByWeek').css("display","none");
			
			}
			else if(this.value == 3){			
				$('#filterByDate').css("display","none");
				$('#filterByMonth').css("display","block");
				$('#filterByWeek').css("display","none");
			}
			else{
				$('#filterByDate').css("display","none");
				$('#filterByMonth').css("display","none");
				$('#filterByWeek').css("display","block");
			}
		
		});
		var header='';
		var totalcount = 0;
		window.onload = function(){
		if(status == "Rejected"){
			$("#rejectedHeader").css("display","block");
		}
		if(status == "Approved"){
			$("#approvedHeader").css("display","block");
		}
			$('#filterByDate').css("display","block");
			$("#totalCountDiv").css("display","none");
			$('#loanFilterDropdown').val(1);
			fromDate = new Date();
			fromDateSplit = String(fromDate).split(' ');
			var monthNumber = parseInt(fromDate.getMonth())+1;
			var inputDate = String(monthNumber)+'/'+fromDateSplit[2]+'/'+fromDateSplit[3];
			fromDate = fromDateSplit[3]+'-'+String(monthNumber)+'-'+fromDateSplit[2];
			toDate = fromDate;
			document.getElementById("filterByDateInput").value = inputDate;
			var html ="";
			var theImg = '<div class="loading"><img style="width:350px;" src="/static/images/buffer-loading.gif">' + '<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>' + '</div>' + '</div>';
            $(".popup").empty().append(theImg).fadeIn();	
			getProcessDataList(fromDate,toDate);	
			
		}
		function submitFormData(id){
			$("#totalCountDiv").css("display","none");
			$("#popup1").css("display","none");
			$("#FilteredDataTable").empty();
			var fromDate='';
			var toDate ='';
			var flag=0;
			if(id == 1){
				fromDate = document.getElementById("filterByDateInput").value;
				if(!fromDate){
					$.alert("Please select the date.");
					flag=1;
					return false;
				}
				fromDateSplit = fromDate.split('/');
				fromDate = fromDateSplit[2]+'-'+fromDateSplit[0]+'-'+fromDateSplit[1];
				toDate = fromDate;
			}
			if(id == 3){
				fromDate = document.getElementById("filterByMonthFrom").value;
				toDate = document.getElementById("filterByMonthTo").value;
				if(!fromDate){
					$.alert("Please select   \"From date\"");
					$("#popup1").css("display","block");
					$("#FilteredDataTable_wrapper").css('display','none');
					return false;
				}
				if(!toDate){
				    $.alert("Please select   \"To date\"");
				    $("#popup1").css("display","block");
					$("#FilteredDataTable_wrapper").css('display','none');
					return false;
				}
				fromDateSplit = fromDate.split('/');
				toDateSplit = toDate.split('/');
				fromDate = fromDateSplit[2]+'-'+fromDateSplit[0]+'-'+fromDateSplit[1];
				toDate = toDateSplit[2]+'-'+toDateSplit[0]+'-'+toDateSplit[1];
				var timeDiff = new Date(toDate).getTime() - new Date(fromDate).getTime();
				if(timeDiff < 0){
					$.alert("Please Enter valid dates!");
					$("#popup1").css("display","block");
					$("#FilteredDataTable_wrapper").css('display','none');
					return false;
				}
				else{
					var diffDays = Math.ceil(Math.abs(timeDiff) / (1000 * 3600 * 24)); 
					if(!(diffDays >= 0 && diffDays <= 31)){
						$.alert("Exceeds more than 30 days!\n\n");
						$("#popup1").css("display","block");
						$("#FilteredDataTable_wrapper").css('display','none');
						return false;
					}
				}
			}
			if(id == 2){
				fromDate = document.getElementById("filterByWeekFrom").value;
				toDate = document.getElementById("filterByWeekTo").value;
				if(!fromDate){
					$.alert("Please select  \"From date\"");
					$("#popup1").css("display","block");
					$("#FilteredDataTable_wrapper").css('display','none');
					return false;
				}
				if(!toDate){
					$.alert("Please select  \"To date\"");
					$("#popup1").css("display","block");
					$("#FilteredDataTable_wrapper").css('display','none');
					return false;
				}
				fromDateSplit = fromDate.split('/');
				toDateSplit = toDate.split('/');
				fromDate = fromDateSplit[2]+'-'+fromDateSplit[0]+'-'+fromDateSplit[1];
				toDate = toDateSplit[2]+'-'+toDateSplit[0]+'-'+toDateSplit[1];
				var timeDiff = new Date(toDate).getTime() - new Date(fromDate).getTime();
				if(timeDiff < 0){
					$.alert("Please Enter valid dates!");
					$("#popup1").css("display","block");
					$("#FilteredDataTable_wrapper").css('display','none');
					return false;
				}
				else{
					var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
					if(!(diffDays >= 0 && diffDays <= 7)){
						$.alert("Exceeds more than 7 days!\n\n");
						$("#popup1").css("display","block");
						$("#FilteredDataTable_wrapper").css('display','none');
						return false;
					}
				}
			}		
			 var theImg = '<div class="loading"><img style="width:350px;" src="/static/images/buffer-loading.gif">' + '<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>' + '</div>' + '</div>';
            $(".popup").empty().append(theImg).fadeIn();
            getProcessDataList(fromDate,toDate);
		}
		
			
		function getProcessDataList(fromDate,toDate){
		
		$.ajax({
					url: '/getProcessListByDate/'+status+'/'+fromDate+'/'+toDate,
					dataType: 'json',
					success: function (data) {	
					$(".popup").fadeOut();	
						if(data["detailsArray"]){
						    totalCount = data["detailsArray"].length;
							$("#totalCountDiv").css("display","block");
							document.getElementById("totalCount").innerHTML = totalCount;
							document.getElementById("recordCount").innerHTML = totalCount;
							var dataArray=[];
							for(var keyVal in data["detailsArray"]){
								var obj={};
								if(data["detailsArray"][keyVal]["status"] == "Successful")
									stathtml = '<span style="color:#981b1b;"><i class="fa fa-check-square"></i>&nbsp&nbsp'+data["detailsArray"][keyVal]["status"]+'</span>';
								else
									stathtml = '<span style="color:#981b1b;"><i class="fa fa-exclamation-triangle"></i>&nbsp&nbsp'+data["detailsArray"][keyVal]["status"]+'</span>';
									obj["SlNo"] = String(parseInt(keyVal)+1)+".";
									obj["createdDate"] =data["detailsArray"][keyVal]["last_modified_date"];
									obj["member_id"] = data["detailsArray"][keyVal]["member_id"];
									obj["loan_id"] = data["detailsArray"][keyVal]["loan_id"];
									obj["membername"] = data["detailsArray"][keyVal]["first_name"]+' '+data["detailsArray"][keyVal]["last_name"];
									obj["date_of_birth"] = data["detailsArray"][keyVal]["date_of_birth"];
									obj["address"] = data["detailsArray"][keyVal]["door_no"] +', '+ data["detailsArray"][keyVal]["street"]+', '+ data["detailsArray"][keyVal]["location"]
									obj["mobileNum"] = data["detailsArray"][keyVal]["mem_phno"];
									obj["user"] = data["detailsArray"][keyVal]["last_modified_by"];
									obj["status"] = stathtml;
									dataArray.push(obj);
							}
							var table = $('#FilteredDataTable').dataTable({
							data: dataArray,
							destroy: true,  
							"bProcessing": true,
							"scrollY": true,
							fixedHeader : true,
							"sPaginationType": "full_numbers",
							"bSortable": true,	
					
							"aoColumns": [	
								{ "mData": "SlNo", "sTitle": "S.No", "sWidth": "5%", className:"column"},     
								{ "mData": "createdDate", "sTitle": "Task Date", "sWidth": "7%", className:"column"},               	  
							{ "mData": "member_id","sTitle": "Member ID"  , "sWidth": "7%", className:"column"},
							{ "mData": "loan_id","sTitle": "Loan ID"  , "sWidth": "7%", className:"column"},
							{ "mData": "membername","sTitle": "Member Name"  , "sWidth": "16%", className:"column"},
							{ "mData": "date_of_birth","sTitle": "DOB", "sWidth": "10%", className:"column"},		
							{ "mData": "address", "sTitle": "Resident Address", "sWidth": "22%", className:"column"},
							{ "mData": "mobileNum", "sTitle": "Mobile No.", "sWidth": "8%", className:"column"},
							{ "mData": "user", "sTitle": "User Name", "sWidth": "9%", className:"column"},
							],           		    
						}).fnDestroy();
							//table.destroy();
							table = $('#FilteredDataTable').DataTable( {
								fixedHeader : true
							} );
							table.destroy();
							table = $('#FilteredDataTable').DataTable( {
								"fnDrawCallback": function () {
									  var rowCount = this.fnPagingInfo().iFilteredTotal;
									  document.getElementById("recordCount").innerHTML = rowCount;
								}	    
							} );
							$('.column').css('padding-bottom', '0px');
							$('.column').css('padding-top', '0px');	
						}
						else{
							$.alert("No records found.");
							$("#popup1").css("display","block");
							$("#FilteredDataTable_wrapper").css('display','none');
						}
						
						}
				});
		}
	</script>	
</html>
