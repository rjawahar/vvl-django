<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css">				<!-- custom css for loan officer process -->

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 

<style>
	.colomn-div label{
		font-size:13px;
		display	: inline-block;
		width: 43%;
		/*width	: 30%;
		/*text-align:right;*/
		text-align: left;
		padding-left: 8%;
	}
	.colomn-div input {
	    display: inline-block;
	    width: 45%;
	    margin-left: 3%;

	}
	.img-input input{
			width	: 43%;
			margin-left:43.5%;
	}

	.center-pane{
		width:50%;
		margin: 3% auto;
		display:block;
		border:2px solid sienna;
		border-radius:10px;
	}
	.h3-heading h3{
		padding-top:20px;
		color:white;
		font-weight:bolder;
		margin-top:initial;
	}
	
</style>

</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
		{% include "header_common.html" %} 
	</div>

	{% csrf_token %}
	<!-- Main Content -->
    	<div class="main">	
	   	<div class="task-div">	
			<div class="main-task">
		   		<div  class="right-pane-task" id="right-pane-task" style="width:100%;margin: 10 auto;">
					<div id="tabs">
					    <ul id="form-tab">
						<li style="float:right;list-style-type:none;">
					    	<span class="comment-toggle" style="float:right;display:inline-block;padding-bottom:10px;s"><i class="entypo-chat"></i> Comments</span>
						</li>
					    </ul>
					</div>
					<div class="right-pane-task-detail detail-max" id="right-pane-task-detail" style="background-color: rgba(218, 216, 216, 0.2);">
     		        			<div class="center-pane" > 
		       					<!--Div HEader-->
							<div class="h3-heading" >
								<h3 >	Disburse Cheque & Collect Pre-EMI Cheque	</h3>
								<h4 	id="loan_id">	Loan ID : 	<span id="loan_Id"> 	421	</span> &	   Member ID : <span id="member_Id"> 	198	</span>	  </h4>
							</div>
							<!--INput Values-->
							<div class="member_class" style="padding-top:20px;">
							   	 <div class="colomn-div">	<label>		Loan Account Number 			</label>	<font>  : </font> 
									<input 	type="text" 	id="loan_account_number" 			name="loan_account_number" 	readonly="true"		placeholder="LOAN ACCOUNT NUMBER"/>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Cheque Number 				</label>	<font>  : </font> 
									<input  type="text" 	id="cheque_number" 			name="cheque_number" 		placeholder="CHEQUE NUMBER"/>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Cheque Number (Pre EMI) 		</label>	<font>  : </font> 
									<input 	type="text" 	id="cheque_number_pre_emi"		name="cheque_number_pre_emi" 		placeholder="CHEQUE NUMBER(PRE EMI)"/>
								</div>
							</div>
							<div class="member_class">
							   	 <div class="colomn-div">	<label>		Cheque Issuer (Bank Name) - (Pre EMI)	</label>	<font>  : </font> 
									<!--input 	type="text" 	id="cheque_issuer_bank_name" 		name="cheque_issuer_bank_name" 		placeholder="CHEQUE ISSUER-BANK NAME"/-->
									 <select id="cheque_issuer_bank_name" class="extra select form-control bank_name cheque_issuer_bank_name" style="margin-left:3%; width:45%;" name="cheque_issuer_bank_name"  placeholder="cheque_issuer_bank_name (DROPDOWN)">
									</select>									
								</div>
							</div>
							<div class="member_class">
							   	<div class="colomn-div">	<label>		Cheque Issuer (Bank Branch) - (Pre EMI)	</label>	<font>  : </font> 
									<input 	type="text" 	id="cheque_issuer_bank_branch" 		name="cheque_issuer_bank_branch" 	placeholder="CHEQUE ISSUER-BANK BRANCH"/>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Payee Name (Pre EMI)			</label>	<font>  : </font> 
									<input 	type="text"	id="payee_name" 			name="payee_name" 			placeholder="PAYEE NAME"/>
								</div>
							</div>
							<div class="member_class">
							    	<div class="colomn-div">	<label>		Amount (Pre EMI)			</label>	<font>  : </font> 
									<input  type="text" 	id="amount"				name="amount" 				placeholder="AMOUNT"/>
								</div>
							</div>
							<div class="member_class" style="padding-bottom:10px;">
							    	<div class="colomn-div">	<label>		Date of Cheque				</label>	<font>  : </font> 
									<input 	type="date" 	id="date_of_cheque" 			name="date_of_cheque" 			placeholder="CHEQUE DATE"/>
								</div>
							</div>
						</div>
					</div>
					<div class="right-pane-task-comment-list comment-min" style="display:none" id="right-pane-task-comment-list">	
		    				<h3>Comments</h3>
						<div class="comment-list-pane" id="comment-list-pane"> </div>																		
	   				</div>
		                        <!--Submit Button DIv-->
					<div class="form-group text-center">
					   	<div class="form-button">
							<a 	href="javascript:void(0)"	 onclick=''	 class="btn btn-red btn-icon icon-left" 	style="height:30px;padding-left:40px;">
						   		<i 	class="icon-entypo-cancel" 	 style="width:30px;height: 28px;color: white;padding:6px;">	</i>
						    		Cancel
							</a>
							<a 	href="javascript:void(0)" 	onclick="onSubmit();" class="btn btn-red btn-icon icon-left" 	style="height:30px;padding-left:40px;">
						    		<i 	class="icon-entypo-check" 	style="width:30px;height: 28px;color: white;padding:6px;">	</i>
						    		Disburse
							</a>
					   	</div>
					</div>
				</div>
   			 </div>
		</div>
	</div>
</div>

	{% include "footer.html" %} 
<script type="text/javascript">

var taskData = {};
var memberdetails= '{{ memberDetails	| safe}}';
var processid 	 = '{{ processId	| safe}}';
var process 	 = '{{ process		| safe}}';
var task_id 	 = '{{ taskId		| safe}}';
var memberId 	 = '{{ memberId		| safe}}';
var loan_id 	 = '{{ loanId		| safe}}';
var user_id 	 = '{{ userId		| safe}}';
var User 	 = '{{ user		| safe}}';
var remarks      = '{{ Application_Remarks | safe}}';
var processObj   =  JSON.parse(process);


    /*Data Parsing and Painting data in HTML*/
    if(memberdetails){
	memberdetails =  JSON.parse(memberdetails);
	console.log(memberdetails);
	if(memberdetails['dcphysicalArray']){
	    if(memberdetails['dcphysicalArray'][0]){
		var dispatchData = memberdetails['dcphysicalArray'][0];
		var keys = Object.keys(dispatchData);
		for(var i=0; i<keys.length; i++){
		    if(document.getElementById(keys[i])){
			document.getElementById(keys[i]).innerHTML = dispatchData[keys[i]];
		    }
		}
	    }
	}
	if(memberdetails['mlcompositeArray']){
	    if(memberdetails['mlcompositeArray'][0]['account_number']){	
		var account_number = memberdetails['mlcompositeArray'][0]['account_number'];
		document.getElementById('loan_account_number').value = account_number;
	    }
	}
	if(memberdetails['PrepareCheque']){
		var preche_cheque_number = memberdetails['PrepareCheque']['preche_cheque_number'];
		document.getElementById('cheque_number').value = preche_cheque_number;
	}
    }

    setSelectOptionInForm();	/*Function in masterDataLoad.js	*/
   
    $(document).ready(function() {

	    $('.comment-toggle').on('click', function () {
		$('#right-pane-task-detail').toggleClass('detail-max detail-min');
		$('#right-pane-task-comment-list').toggleClass('comment-min comment-max');
	    });

	var screenHeight  = $(window).height();
			var screenwidth   = $(window).width();
			if(screenHeight)
			{
				var height       =  screenHeight*(0.9);
				var slipHeight   =  height/3;
				$('body').height((height*(0.80)));
				$('.task-div').height((height*(0.80)));
				$('.main-task').height((height*(0.80)));
				$('#right-pane-task').height((height));
				$('#right-pane-task-detail').height((height*(0.75)));
				$('#right-pane-task-comment-list').height((height*(0.795)));
				document.getElementById('right-pane-task-detail').style.overflowY  =  'auto';
		
			}
	});

	$(function() {
		$("#tabs").tabs();
	});
                       

    function onSubmit(){
        console.log('onSubmit');
    
    	var currentDateValue  = (new Date());
	currentDateValue = JSON.stringify(currentDateValue);
	currentDateValue = currentDateValue.replace(/"/g,'');
	currentDateValue = currentDateValue.split('T')[0];
    
	var user_Id			=	"{{ user }}";
	var loan_account_number		=	document.getElementById("loan_account_number").value;
	var cheque_number		=	document.getElementById("cheque_number").value;
	var cheque_number_pre_emi	=	document.getElementById("cheque_number_pre_emi").value;
	var cheque_issuer_bank_name	=	document.getElementById("cheque_issuer_bank_name").value;
	var cheque_issuer_bank_branch	=	document.getElementById("cheque_issuer_bank_branch").value;
	var payee_name			=	document.getElementById("payee_name").value;
        var amount			=	document.getElementById("amount").value;                            
	var date_of_cheque		=	document.getElementById("date_of_cheque").value;     						


	if(!cheque_number_pre_emi){
		alert('Please enter Cheque Number of Pre Emi');
		return false;
	}
	if(!cheque_issuer_bank_name){
		alert('Please enter Bank Branch Name of the Cheque Issuer');
		return false;
	}
	if(!cheque_issuer_bank_branch){
		alert('Please enter the Branch Name of the Cheque Issuer');
		return false;
	}
	if(!payee_name){
		alert('Please enter Payee Name');
		return false;
	}
	if(!amount){
		alert('Please enter the Amount');
		return false;
	}
	if(!date_of_cheque){
		alert('Please enter Date of Cheque');
		return false;
	}


	var che_details	= {
				"disburse_loan_id"		:	parseInt(loan_id),
				"disburse_member_id"		:	parseInt(memberId),
				"loan_account_number"		:	loan_account_number,
				"disburse_cheque_number"	:	cheque_number,
				"pre_emi_cheque_number"		:	cheque_number_pre_emi,
				"pre_emi_bank_name"		:	cheque_issuer_bank_name,
				"pre_emi_bank_branch"		:	cheque_issuer_bank_branch,
				"pre_emi_payee_name"		:	payee_name,
				"pre_emi_amount"		:	parseFloat(amount),
				"pre_emi_chq_issued_on_date"	:	date_of_cheque,
				"last_modified_date"		:	currentDateValue,
				"last_modified_by"		:	user_id
				
			  };
	
	
	console.log(che_details);
	var processupdate = {"variables": { "Collect_Pre_EMI_Status" : { "value" : "Collected" } } };	
	var dataObj = {};
	dataObj['processid'] 	= processid;
	//dataObj['taskremarks']  = remarksData;
	dataObj['loanid'] 	= loan_id;
	dataObj['taskid'] 	= task_id;
	dataObj['userid'] 	= user_id;
	dataObj['process'] 	= processupdate;
	//dataObj['remarksData'] 	= remarksData;	
	
	        
	dataObj["disburseCheque"] = che_details;
	dataObj["processDetails"] = processupdate;
	dataObj["taskid"]	  = task_id;	        
	             
	            
    	urls = '/disburseChequeAndPreEmi';

        $.ajax({
	        url: urls,
	        type: 'post',
	        dataType: 'json',
	        success: function(data){
		        if(data.message == "Successful"){
			        console.log(data);
			        //window.location='/tasks/';
		        }else{
			        alert("Failed due to some Issue . Please try after sometime or contact your Administrator");
		        }
	        },
	        data: JSON.stringify(dataObj)
        });
	

    }
</script>

</body>
</html>

