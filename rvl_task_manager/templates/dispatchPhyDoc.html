<!DOCTYPE html>
<html>
<head>

<link type="text/css" href="/static/css/bootstrap.css" rel="stylesheet"  />
<link type="text/css" href="/static/css/jquery.selectBoxIt.css" rel="stylesheet" />
<link type="text/css" href="/static/css/task.css" rel="stylesheet" />
<!-- Madura css -->
<link rel="stylesheet" href="/static/css/font-icons/entypo/css/entypo.css"  id="style-resource-2">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic"  id="style-resource-3">
<link rel="stylesheet" href="/static/css/neon-core-min.css"  id="style-resource-5">
<link rel="stylesheet" href="/static/css/neon-theme-min.css"  id="style-resource-6">
<link rel="stylesheet" href="/static/css/neon-form-min.css"  id="style-resource-7">
<link rel="stylesheet" href="/static/css/jalert.css">
<link rel="stylesheet" href="/static/css/form.css">
<link rel="stylesheet" href="/static/css/custom2.css">				<!-- custom css for loan officer process -->

<!-- Scripts -->
<script type="text/javascript" src="/static/js/1.9.1-jquery.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>	<!-- Main Library js-->
<script type="text/javascript" src="/static/js/bootstrap.js"></script>		<!-- Bootstrap js-->
<script type="text/javascript" src="/static/js/jquery.selectBoxIt.js"></script>
<script type="text/javascript" src="/static/js/crossfilter.js"></script> 

<!--MASTER DATA -->
<script type="text/javascript" src="/static/form/masterData.js"></script> 
<script type="text/javascript" src="/static/form/masterDataLoad.js"></script> 

</head>
<body>
	<!-- Top Bar -->
	<div class="navbar navbar-fixed-top">
		{% include "header_common.html" %} 
	</div>

	{% csrf_token %}
	<!-- Main Content -->
    	<div class="main">	
	    <div class="task-div">	
		<div class="main-task">
		   <div  class="right-pane-task" id="right-pane-task" style="width:100%;margin: 10 auto;">
		       <div class="center-pane" style="width:50%;margin: 3% auto; display:block;"> 
		       
		     		<!--Div HEader-->
				<div class="h3-heading" >
					<h3 >Dispatch Physical Document</h3>
					<h4 id="loan_id">Loan No : <span id="loan_Id">514243656648453</span>    &   Member Id : <span id="member_Id">551</span> </h4>
				</div>
				
				<!--INput Values-->
				<div class="member_class" >
				    <div class="colomn-div"><label>Courier Name</label><font>  : </font>
					<select id="doc_courier_name" class="extra select form-control doc_courier_name"   	name="doc_courier_name"  	placeholder="doc_courier_name"	></select> 
					<font class="mandatory">*</font>
				    </div>
				</div>
				<div class="member_class" >
				    <div class="colomn-div"><label>Receipt Number</label><font>  : </font><input type="text" id="doc_courier_receipt_number"    name=""     placeholder="RECEIPT NUMBER"	/><font class="mandatory">*</font></div>
				</div>
				<div class="member_class">
				    <div  class="colomn-div"><label>Tracking Id</label><font>  : </font><input type="text" id="doc_courier_tracking_id"         name=""  	   placeholder="TRACKING ID"	/><font class="mandatory">*</font></div>
				</div>
				<div class="member_class">
				    <div  class="colomn-div"><label>Date</label>	<font>  : </font><input type="text" id="doc_courier_handover_date"      name=""  	   placeholder="DATE"	/><font class="mandatory">*</font></div>
				</div>
				
				<!--Submit Button DIv-->
				<div class="form-group text-center">
				    <div class="form-button">
					<a href="javascript:void(0)" onclick='' class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
					   <i class="icon-entypo-cancel" style="width:30px;height: 28px;color: white;padding:6px;"></i>
					    Cancel
					</a>
					<a href="javascript:void(0)" onclick="onSubmit();" class="btn btn-red btn-icon icon-left" style="height:30px;padding-left:40px;">
					    <i class="icon-entypo-check" style="width:30px;height: 28px;color: white;padding:6px;"></i>
					    Submit
					</a>
				    </div>
				</div>
		       </div> 
		    </div>
		</div>
	    </div>
	</div>

	{% include "footer.html" %} 
</body>
<style>
#ui-datepicker-div{
	z-index: 999;
}
</style>
<script type="text/javascript">  
	
var taskData = {};
var memberdetails = '{{memberDetails|safe}}';
var processid 	= '{{processId|safe}}';
var process 	= '{{process|safe}}';
var taskid 	= '{{taskId|safe}}';
var User 	= '{{user|safe}}';
var userid	= '{{userId|safe}}';
var memberId 	= '{{memberId|safe}}';
var loanId 	= '{{loanId|safe}}';
var remarks 	= '{{Application_Remarks|safe}}';
var processObj 	= JSON.parse(process);

jQuery(document).ready(function($) {

    /*Date Picker*/	
    $("#doc_courier_handover_date").datepicker({ dateFormat: 'yy-mm-dd', changeMonth: true,//this option for allowing user to select month
     	changeYear: true });

    /*Dropdown menu for users */	
    $('.dropDownHook span').on('click', function() {
        $(this).parents('.dropDownHook').children('.dropDownContent').stop(true, true).slideToggle('medium', function() {
            if ($('.dropDownContent').is(':visible')) {
            }
            else {
            }
        });
    });
    $('html').on('click', function() {
        $('.dropDownContent:visible').slideToggle('fast');
    });
    $('.dropDownHook > *').on('click', function(event) {
        event.stopPropagation();
    });



    /*Div header with loan and member id*/
    if(loanId){
	document.getElementById("loan_id").innerHTML = "Loan Id :  " +loanId+ "    &   Member Id : "+memberId;
    }
    
    /*Parse Data*/
    if(memberdetails){
	data = JSON.parse(memberdetails);
    }
    
    /*Master Data Parse and paint on screen*/
    setSelectOptionInForm();	/*Function in masterDataLoad.js	*/
});

function onSubmit(){

	/*Input Values*/
	var doc_courier_name 		= document.getElementById("doc_courier_name").value;
	var doc_courier_receipt_number 	= document.getElementById("doc_courier_receipt_number").value;
	var doc_courier_handover_date 	= document.getElementById("doc_courier_handover_date").value;
	var doc_courier_tracking_id 	= document.getElementById("doc_courier_tracking_id").value;

	/*Input value validation*/
	if(!doc_courier_name){
		alert('Please enter Courier Name');
		return false;
	}
	if(!doc_courier_receipt_number){
		alert('Please enter Courier receipt Number');
		return false;
	}
	if(!doc_courier_handover_date){
		alert('Please enter Courier Handover Date');
		return false;
	}
	if(!doc_courier_tracking_id){
		alert('Please enter Tracking Id');
		return false;
	}
	
	/*Current Data*/	
	var currentDateValue  = (new Date());
	currentDateValue = JSON.stringify(currentDateValue);
	currentDateValue = currentDateValue.replace(/"/g,'');

	/*Formating the input values for AVRO*/
	var dataArr = {"dcphysicalArray":[
				{
				"fk_member_id"			: parseInt(memberId),
				"fk_loan_id"			: parseInt(loanId),
				"doc_courier_tracking_id" 	: doc_courier_tracking_id,
				"doc_courier_handover_date" 	: doc_courier_handover_date,
				"doc_courier_name"	  	: doc_courier_name,
				"doc_courier_receipt_number"	: doc_courier_receipt_number,	
				"doc_courier_tracking_id "	: doc_courier_tracking_id ,
				"last_modified_by"		: parseInt(1)
				}]
		            };

	/*Process Details formating*/
	var processCompleteTask = {
				"variables": {
				    "LoanDoc_Physical_Status" : {
					"value" : "New", 
					"type"	: "String"
				    },
				    "Application_Remarks" : {
					"value" : "Approved", 
					"type"	: "String"
				    }
				}
			   };

	/*Merging of data for sending through POST AJAX*/
	var dataObj = {
		"dispatchDetails": dataArr,
		"processDetails" : processCompleteTask,
		"taskid"	 : taskid,
		"function"	 : "save"
	}
	
	/*Loading IMages*/	
	var theImg = '<div class="loading"><img style="width:350px;height:250px;" src="/static/images/buffer-loading.gif">'
		 +'<div style="padding-top:1%;" ><label style="padding-top:1%;">LOADING ...</label>'
			    +'</div>'
		+'</div>';
	$(".popup").empty().append(theImg).fadeIn();	
	
	/*AJAX call:*/
	var url = "/dispatch/";
	$.ajax({
	    url: url,
	    type: 'post',
	    dataType: 'json',
	    success: function (data) {
	        $(".popup").fadeOut();
		window.location='/tasks/';	
	    },
	    data: JSON.stringify(dataObj)
	});
}
</script>
</html>
